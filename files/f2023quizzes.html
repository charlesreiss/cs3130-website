
<h1 style='text-align:center'>quiz for week 1</h1><div class='directions'><p>Answer the following questions about the lecture for this week.</p>
</div><div class='question' id='q1' slug='f76e7022'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.41)
<p>Suppose we build a dynamically linked library and a program that uses it
as follows</p>

<pre><code>clang -c utility1.c
clang -c utility2.c
clang -shared -o libutility.so utility1.o utility2.o
clang -c main.c
clang -o main.exe main.o -L. -l utility -Wl,-rpath .
</code></pre>

<p>If we modify <code>utility2.c</code>, then we should rerun which commands
in order to make sure <code>main.exe</code> uses the most recent version of
that the code in <code>utility2.c</code>?
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='78f9f46b' disabled='disabled'/><div><p><code>clang -c utility1.c</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>99%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='493f39ae' disabled='disabled'/><div><p><code>clang -c utility2.c</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>97%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='4e25eb64' disabled='disabled'/><div><p><code>clang -shared -o libutility.so utility1.o utility2.o</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>11%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='cb60ba59' disabled='disabled'/><div><p><code>clang -c main.c</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>60%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='b6d03b73' disabled='disabled'/><div><p><code>clang -o main.exe main.o -L. -l utility -Wl,-rpath .</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='f76e7022'/></form></details></div><div class="multiquestion"><p>Suppose a C project has a header file <code>constants.h</code>
that is generated by processing a CSV <code>constants.csv</code>
file with C program called <code>csvtoconstantsh</code>.</p>

<p>Then constants.h is used with main.c to generate a <code>main</code> executable.
When run by hand the following sequence of commands are used:</p>

<pre><code>clang -c csvtoconstantsh.c
clang -o csvtoconstantsh csvtoconstants.o
./csvtoconstantsh constants.csv constants.h
clang -c main.c
clang -o main main.o
</code></pre>
<div class='question' id='q2' slug='0f33c24c'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.84) (see above)
<p>Suppose the above commands are run, and then
<code>constants.csv</code> is modified. Which commands should be rerun
to handle these changes?
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans2' value='564e2be3' disabled='disabled'/><div><p><code>clang -c csvtoconstantsh.c</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>6%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans2' value='27bd2422' disabled='disabled'/><div><p><code>clang -o csvtoconstantsh csvtoconstants.o</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='40b85140' disabled='disabled'/><div><p><code>./csvtoconstantsh constants.csv constants.h</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>95%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='1ffeee36' disabled='disabled'/><div><p><code>clang -c main.c</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>97%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='b2c34244' disabled='disabled'/><div><p><code>clang -o main main.o</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='0f33c24c'/></form></details></div><div class='question' id='q3' slug='45589452'><div class='description' id='d3'><strong>Question 3</strong> (6 pt; mean 5.65) (see above)
<p>When writing a Makefile to handle building this project,
one might have a rule for <code>constants.h</code>:</p>

<pre><code>constants.h: ...
(tab)./csvtoconstantsh constants.csv constants.h
</code></pre>

<p>where <code>...</code> is is a list that includes ___ (and <code>(tab)</code> represents
a tab character). <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>96%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='31b977ce' disabled='disabled'/><div><p><code>constants.csv</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='a390a475' disabled='disabled'/><div><p><code>constants.h</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>92%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='b2c3edd1' disabled='disabled'/><div><p><code>csvtoconstantsh</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>15%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='0ba58d8b' disabled='disabled'/><div><p><code>csvtoconstantsh.o</code></p>
</div></label><div class='explanation'><p>would not be harmful to include, but should not be necessary since we need another rule to handle building <code>csvtoconstantsh</code> from <code>csvtoconstantsh.o</code>, and that rule should have this dependency</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>5%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='a3b1363c' disabled='disabled'/><div><p>the names of <code>.c</code> files which <code>#include</code> constants.h</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='cadaa702' disabled='disabled'/><div><p>the names of other <code>.h</code> files used by the C project</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='45589452'/></form></details></div></div><div class='question' id='q4' slug='5b6c23c0'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 2.88)
<p>Consider a Makefile with the following contents:</p>

<pre><code>foo.exe: foo.c
(tab)clang -c foo.c
(tab)clang -o foo.exe foo.o
</code></pre>

<p>compared to a Makefile with the following contents:</p>

<pre><code>foo.exe: foo.o
(tab)clang -o foo.exe foo.o

foo.o: foo.c
(tab)clang -c foo.c
</code></pre>

<p>(<code>(tab)</code> represents a tab character.)</p>

<p>It is possible to set the modifications times of <code>foo.exe</code>, <code>foo.o</code>
and <code>foo.c</code> such that running <code>make foo.exe</code> will ____ with the
first Makefile, but ____ with the second.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>10%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='70456e93' disabled='disabled'/><div><p>update <code>foo.exe</code> with the first Makefile, but do nothing with the second</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>71%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans4' value='8a6e6837' disabled='disabled'/><div><p>do nothing with the first Makefile, but update <code>foo.exe</code> with the second</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>15%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='7aee7762' disabled='disabled'/><div><p>both the above</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='c6016586' disabled='disabled'/><div><p>none of the above</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='5b6c23c0'/></form></details></div>
﻿
<h1 style='text-align:center'>quiz for week 2</h1><div class='directions'><p>Answer the following quesitons about the lecture material for this week.</p>
</div><div class='question' id='q1' slug='dd09f208'><div class='description' id='d1'><strong>Question 1</strong> (3 / 4 pt; mean 2.87)
<p>Operating systems could provide a system call that provides the functionality
of <code>printf</code>, but they usually do not. Instead, <code>printf</code> is usually implemented
in a library function that may internally make some system calls.</p>

<p>What are typically advantages of this approach? <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>80%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='33bc5786' disabled='disabled'/><div><p>updating the <code>printf</code> implementation (for example, to fix a bug) requires modifying fewer files</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>21%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='a3e6b788' disabled='disabled'/><div><p>since the hardware handles starting a system call, the system call implementation cannot read its arguments from the stack, so <code>printf</code> calls with many arguments would need to be made in a different way</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>88%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='b0ba1089' disabled='disabled'/><div><p>bugs in <code>printf</code>'s format string handling are less likely to result in serious security issues</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>61%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans1' value='7eb56594' disabled='disabled'/><div><p>this <code>printf</code> implementation can display text on the screen without having the processor enter kernel mode (but the dedicated system call would always enter kernel mode for this)</p>
</div></label><div class='explanation'><p>I think the better answer is that this is not the case. Generally, it's usually the case that devices cannot be accessed without being in kernel mode. It's true that there are exceptions to this, but even so, since the screen being a shared resource means the OS needs to arbitrate access to it so those accesses necessairily need to happen in kernel mode, but there are corner cases where it isn't true (I should've phrased the question to more explicitly refer to a situation where the screen is definitely shared)</p>
</div></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='dd09f208'/></form></details></div><div class="multiquestion"><p>Consider a Unix-like system with a single-core running three (single-threaded) processes, an SSH client, a graphical terminal
(which is being used to display the SSH client), and a program performing a long computation</p>

<p>Initially process SSH client is active on the CPU, then the following events happen in the following order:</p>

<ol>
<li>The SSH client computes some data and outputs it to the network.</li>
<li>The SSH client waits for new input from the network or its terminal</li>
<li>While the SSH client is waiting, the long computation program runs.</li>
<li>An "enter" keypress occurs, so the terminal program starts running to process it.</li>
<li>The terminal program adjusts the image it displays to account for a new line.</li>
<li>The terminal program forwards the keypress to the SSH client.</li>
<li>The SSH client receives the keypress.</li>
<li>As a result of the keypress, the SSH client sends something on the network.</li>
</ol>
<div class='question' id='q2' slug='cfa916aa'><div class='description' id='d2'><strong>Question 2</strong> (0 / 4 pt; mean 3.7) (see above)
<p>How many context switches must occur between steps 1 and 8 above?</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans2' disabled='disabled'/></div>Key: <tt>3</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='cfa916aa'/></form></details></div><div class='question' id='q3' slug='f6de16d4'><div class='description' id='d3'><strong>Question 3</strong> (0 / 4 pt; mean 3.25) (see above)
<p>A <em>non-system-call</em> exception is likely to occur as part of which steps above?
Write the numbers of the relevant steps; for example, if you think steps 2 and 7
will have a a non-system-call exception occur, then write "27".</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans3' disabled='disabled'/></div>Key: <tt>4</tt><div class='explanation'><p>also accepted 1 and 8 on the theory that the network interface needs to inform the OS when more output can be accepted via exception, though I don't think this is especially likely except on very loaded network (and it wasn't my intention to test about this kind of issue)</p>

<p>also accepted 2 or 3 (but not both) [theory that SSH client is waiting in a loop rather than having a system call that puts the program to sleep, so we need an timer interrupt to switch to the long computation. I think this is unlikely (we don't like our programs hogging the processor while waiting for input), but not unreasonable.]</p>

<p>[to be handled in manual grading]: -1 point per disagreement</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='f6de16d4'/></form></details></div><div class='question' id='q4' slug='35168db5'><div class='description' id='d4'><strong>Question 4</strong> (0 / 4 pt; mean 2.11) (see above)
<p>One or more system calls are likely to be <em>started</em> during which of the steps above?
Write the numbers of the relevant steps; for example, if you think steps 2 and 7
will have a system call be started, then write "27".</p>

<p>Do not include steps for which a system call already in progress is resumed
(but do include cases where a system call is both started and finished
within the step).</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans4' disabled='disabled'/></div>Key: <tt>12568 or 1258</tt><div class='explanation'><p>(12568 is a better answer, but we have not taught enough about how processes communicate to discount number 6 happening via shared memory instead of a system call)</p>

<p>[to be handled in manual grading]: -1 point per disagreement</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='35168db5'/></form></details></div></div><div class='question' id='q5' slug='ae3ed3ab'><div class='description' id='d5'><strong>Question 5</strong> (0 / 4 pt; mean 3.83)
<p>Suppose a program running on a Linux system contains the following
line:</p>

<pre><code>*pointer = 42;
</code></pre>

<p>When <code>pointer</code> does not specify a valid memory location (and no setup
has been done to handle this situation specially), this line will
cause the program to crash (terminating with an error).
To make this happen, ____.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='520a23ba' disabled='disabled'/><div><p>code generated by the compiler detects that the memory access is out of bounds, and therefore makes a system call to terminate the program</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='f05fd88d' disabled='disabled'/><div><p>the compiler makes a system call to do the memory update, and operating system code in this system call checks whether or not the memory location is valid</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>82%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans5' value='3f47f159' disabled='disabled'/><div><p>the hardware implementation of the instruction that attempts the invalid memory access instead causes a special handler function in the operating system to run in kernel mode</p>
</div></label><div class='explanation'><p>I think this (C) is the best answer.</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>12%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⅞</div><input type='radio' name='ans5' value='5490e880' disabled='disabled'/><div><p>the hardware implementation of the instruction that attempts the invalid memory access instead causes a handler to run in user mode, and the default version of this handler makes a system call to terminate the program</p>
</div></label><div class='explanation'><p>We gave full credit to this answer during regrading. The intention of this question was to state that the hardware runs the handler for C and D, which would make D definitely incorrect. The language "causes" is unfortunately less precise, though I believe "the hardware runs the handker" would be the most natural reading. Also, when there's no signal handler registered, the default action is taken by the kernel without running code in user mode, so the notion that a default handler makes a system call is not correct.</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='308bbf5f' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='ae3ed3ab'/></form></details></div>
﻿
<h1 style='text-align:center'>quiz for week 3</h1><div class='directions'></div><div class="multiquestion"><p>Consider the following C code:</p>

<pre><code>int global = 0;

void handle_sigint(int id) {
    global += 1;
    printf("SIGINT: global=%d\n", global);
}

int main() {
    Initialize();
    struct sigaction sa;
    sa.sa_handler = &amp;handle_sigint;
    sigemptyset(&amp;sa.sa_mask);
    sa.sa_flags = SA_RESTART;
    sigaction(SIGINT, &amp;sa, NULL);

    char line[128];
    while (fgets(line, sizeof line, stdin)) {
        Process(line);
    }
}
</code></pre>

<p>Assume all necessary <code>#include</code>s and an implementation of the
<code>Initialize</code> and <code>Process</code> functions are included,
that these functions do not do anything with signals,
that the system is setup so control-C always sends the signal SIGINT,
and the C code is compiled into an executable.</p>
<div class='question' id='q1' slug='fdcd73c4'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.87) (see above)
<p>While the executable is waiting for input, a user presses
control-C, which results in the SIGINT signal being triggered
and the signal handler printing out a
message like <code>SIGINT: global=1</code>.</p>

<p>When the signal handler runs in this scenario,
the signal handler will ____. <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='cb801e48' disabled='disabled'/><div><p>have a separate copy of <code>global</code> from the rest of the program</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='b25c068e' disabled='disabled'/><div><p>run in user mode</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>57%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans1' value='250bddd7' disabled='disabled'/><div><p>run before <code>fgets</code> makes a system call</p>
</div></label><div class='explanation'><p>should have written "starts any system calls" (in which case it is clearly false), "makes a system call" had some other interperations I did not expectt</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>9%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='38d95de3' disabled='disabled'/><div><p>use a different address space (mapping of program to real addresses) than the call to <code>fgets</code> did</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='fdcd73c4'/></form></details></div><div class='question' id='q2' slug='dcf7a875'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.23) (see above)
<p>While running this program, a developer observes
that pressing control-C usually
results in it printing a message like <code>SIGINT: global=1</code> and continuing
to look for input, but sometimes instead it makes the program terminate.</p>

<p>Which of the following situations will cause the program to terminate this way?</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='538878bd' disabled='disabled'/><div><p>control-C is pressed more than once</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>70%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans2' value='8c590c72' disabled='disabled'/><div><p>control-C is pressed while the program is running Initialize()</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='78630cb4' disabled='disabled'/><div><p>control-C is pressed while the program is running Process()</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>½</div><input type='radio' name='ans2' value='ba26546f' disabled='disabled'/><div><p>A or B</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='b33aae5c' disabled='disabled'/><div><p>A or C</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>18%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>½</div><input type='radio' name='ans2' value='46447e0c' disabled='disabled'/><div><p>B or C</p>
</div></label><div class='explanation'><p>[adjusted to half-credit on 10 Dec for consistency with how some TAs graded comments on this question (which was more lenient than I had intended/expected)]</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='1d16e3af' disabled='disabled'/><div><p>all of the above</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='1da260e9' disabled='disabled'/><div><p>none of the above (other/additional conditions are needed to cause this)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='dcf7a875'/></form></details></div></div><div class='question' id='q3' slug='7227c41d'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.94)
<p>On a Unix-like system, generally two processes with the same user IDs and group IDs ____.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>100%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='4fad52d4' disabled='disabled'/><div><p>can open and read from the same set of files</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>97%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='a44474d3' disabled='disabled'/><div><p>can send signals to each other</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='c4e027fb' disabled='disabled'/><div><p>have the same process ID</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='5d945241' disabled='disabled'/><div><p>use the same memory for the stack</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='7227c41d'/></form></details></div><div class='question' id='q4' slug='ff9da88e'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 2.32)
<p>Consider the following access control list:</p>

<pre><code>user:aaa1a:r--
user:bbb1b:rw-
user:ccc1c:r--
other::---
</code></pre>

<p>(<code>other::---</code> represents that users and groups not otherwise listed have no access.)</p>

<p>To allow us to replicate the effects of this access control list with 
<code>chmod</code>-style permissions, we could create a new group
and make it so programs run by ____ are assigned to that group.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>9%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans4' value='ea14efc7' disabled='disabled'/><div><p><code>aaa1a</code>, <code>bbb1b</code>, and <code>ccc1c</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>39%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans4' value='e752c534' disabled='disabled'/><div><p><code>aaa1a</code> and <code>ccc1c</code></p>
</div></label><div class='explanation'><p>I made a mistake by not having an "either A or B" option when writing this question. We'll accept either A or B or none of the above explaining A or B would be okay.</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='763b5d01' disabled='disabled'/><div><p>just <code>bbb1b</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>22%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='12ad0863' disabled='disabled'/><div><p>either B or C</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>11%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='ef0ef756' disabled='disabled'/><div><p>none of the above --- there's no way to replicate the ACL's effects with chmod-style permissions</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>15%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='9690d0a6' disabled='disabled'/><div><p>none of the above --- explain in comments</p>
</div></label><div class='explanation'><p>we will accept this answer if it explains A or B, but that will be done via manual grading</p>
</div></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='ff9da88e'/></form></details></div><div class='question' id='q5' slug='a41fa20b'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 3.47)
<p>Which of the following scenarios can we achieve on a shared machine like the portal servers
with the POSIX access control lists we discussed in lecture? <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>77%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='da8bc480' disabled='disabled'/><div><p>two users can both add to a file, but neither can see what the other added</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>100%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='d7aee070' disabled='disabled'/><div><p>any student can put files in a shared directory so that a faculty member can read them, but a student cannot read another student's submissions in this directory</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>28%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='216f8f80' disabled='disabled'/><div><p>any user can append to or read a file, but only the system administrator can overwrite it</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>96%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='f0b9500a' disabled='disabled'/><div><p>four students can all read and modify a single text document, but other students cannot read or modify it at all</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='a41fa20b'/></form></details></div>
﻿
<h1 style='text-align:center'>quiz for week 4</h1><div class='directions'><p>Answer the following questions about the lecture material for this week.</p>
</div><div class="multiquestion"><p>For the following questions,
consider a system with 7-bit page offsets,
10-bit virtual addresses
and 11-bit physical addresses and the following page table:</p>

<table>
<thead>
<tr><td>index (virtual page #, in binary)</td><td>valid?</td><td>physical page # (in binary)</td></tr>
</thead>
<tbody>
<tr><td>000</td><td>0</td><td>&mdash;</td></tr>
<tr><td>001</td><td>1</td><td>0110</td></tr>
<tr><td>010</td><td>1</td><td>1001</td></tr>
<tr><td>011</td><td>1</td><td>1010</td></tr>
<tr><td>100</td><td>1</td><td>1111</td></tr>
<tr><td>101</td><td>1</td><td>0010</td></tr>
<tr><td>110</td><td>1</td><td>0110</td></tr>
<tr><td>111</td><td>0</td><td>&mdash;</td></tr>
</tbody>
</table>
<div class='question' id='q1' slug='7c695507'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.87) (see above)
<p>What is a physical address for virtual address (written in binary) 0100001110?
Write your answer in binary; if there is no corresponding physical address
write "none".</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans1' disabled='disabled'/></div>Key: <tt>10010001110</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='7c695507'/></form></details></div><div class='question' id='q2' slug='27e2b6cc'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.76) (see above)
<p>What is a virtual address for the physical address (written in binary) 01100001110?
Write your answer in binary; if there is no corresponding virtual address
write "none".</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans2' disabled='disabled'/></div>Key: <tt>0010001110 or 1100001110</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='27e2b6cc'/></form></details></div></div><div class='question' id='q3' slug='ca0f0b0a'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.52)
<p>Consider a program executing the following instruction:</p>

<pre><code>movq %rax, (%rcx)
</code></pre>

<p>whose machine code is located at address <code>0x300010</code>.
Suppose <code>%rax</code> contains <code>0x999000</code>, and <code>%rcx</code>
contains <code>0x123450</code>,
and the system uses 4096-byte pages (so addresses
have 12-bit page offsets).</p>

<p>In the process of <strong>fetching and executing</strong> that instruction,
the processor will
access a page table entry for virtual pages ____.
List the virtual page numbers in hexadecimal separated by commas.
For example, if you think the answer is virtual pages 0x33,
0x43 and 0x45, write <code>0x33,0x44,0x45</code>.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans3' disabled='disabled'/></div>Key: <tt>0x123,0x300 or 0x300,0x123</tt><div class='explanation'><p>half-credit for just one</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='ca0f0b0a'/></form></details></div><div class="multiquestion"><p>Consider a system with page tables that are stored in memory as a single array.
Suppose the system uses <strong>65536</strong> byte pages (so addresses have 16-bit page offsets),
4-byte page entries,
and the page table base register is set to physical (byte) address <code>0x30000</code>
(so the page table entry with index 0 is at <code>0x30000</code>, the
one with index 1 at <code>0x30004</code>, the one with index 2 at <code>0x30008</code>, etc.)</p>

<p>As part of translating a virtual address to a physical address, the system:</p>

<ul>
<li>accesses a page table entry at physical address <code>0x30110</code>, and</li>
<li>determines that the resulting physical address for the virtual address is <code>0x999433</code></li>
</ul>
<div class='question' id='q4' slug='c7aca2ca'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.54) (see above)
<p>What was the physical page number contained in the page table entry that was found?
Write your answer as a hexadecimal number.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans4' disabled='disabled'/></div>Key: <tt>0x99</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='c7aca2ca'/></form></details></div><div class='question' id='q5' slug='79f4a823'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 3.09) (see above)
<p>What was the virtual address being translated?
Write your answer as a hexadecimal number.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans5' disabled='disabled'/></div>Key: <tt>0x449433</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='79f4a823'/></form></details></div></div><div class='question' id='q6' slug='3b852447'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.9)
<p>On a system with a page tables stored in memory as a single array, if one process
can access twice as many addresses as another, then ____.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>78%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans6' value='ed2adb99' disabled='disabled'/><div><p>that process must use 1 more virtual address bit than the other process</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>8%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='1335fd5b' disabled='disabled'/><div><p>that process must use 1 more physical address bit than the other process</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>37%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤ (accepted any answer)</div><input type='checkbox' name='ans6' value='2764c7ff' disabled='disabled'/><div><p>that process must have more "valid" bits set to 1 in its page table entries</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>66%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans6' value='ba0a49ee' disabled='disabled'/><div><p>that process's page table must take up twice as much space than the other process's</p>
</div></label></li></ol><div class='explanation'><p>intended reading of quesiton was that "would cause segfault" means "can't access". Under that interpration, only C is correct. Some students said that, yes, we can access an address if that always triggers an exception. Under that interpretation, only A and D are correct</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='3b852447'/></form></details></div>
﻿
<h1 style='text-align:center'>quiz for week 5</h1><div class='directions'><p>Answer the following questions about the lecture material for this week.</p>
</div><div class="multiquestion"><p>For the following questions, consider a system with:</p>

<ul>
<li><em>two-level</em> page tables</li>
<li>page tables (at each level) containing 32 page table entries, each of which is 2 bytes in size</li>
<li>64-byte pages</li>
<li>16-bit virtual addresses</li>
<li>20-bit physical addresses</li>
</ul>
<div class='question' id='q1' slug='88b5c2ab'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.36) (see above)
<p>Consider an access to virtual address <code>0xABCD</code>,
where during the access:</p>

<ul>
<li>the page table base register has the (byte) address <code>0x03300</code>,</li>
<li>the first-level page table entry used contains the physical page number <code>0x0123</code></li>
<li>the second-level page table entry used contains the physical page number <code>0x0456</code></li>
</ul>

<p>Then, at what physical address is the first-level page table entry located?
Write your answer as a hexadecimal number.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans1' disabled='disabled'/></div>Key: <tt>0x332a</tt><div class='explanation'><p>VA = [5 bit VPN part 1][5 bit VPN part 2][6 bit page offset]</p>

<p>first-level addr = PTBR + VPN part 1 * 2 = 0x3300 + (binary 10101) * 2</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='88b5c2ab'/></form></details></div><div class='question' id='q2' slug='c9108d4b'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 2.54) (see above)
<p>If a process's page tables allow it to access 6400 bytes worth of distinct physical addresses,
then its page tables take up at least ____ bytes.</p>

<p>(Assume none of the 6400 bytes of addresses the process can access are used to store its
page table entries.)</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans2' disabled='disabled'/></div>Key: <tt>320</tt><div class='explanation'><p>half-credit for 256</p>

<p>each 2nd-level table can point to up to 64 * 32 bytes of data (if all the entries are valid and point to distinct data pages), to total more than 6400 bytes we need at least 4 2nd-level tables, which take up 256 bytes. We also need a first-level table to point to the second-level table tthat will take up 64 bytes even though it is mostlyinvalid entries), giving 320 bytes total.</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='c9108d4b'/></form></details></div></div><div class='question' id='q3' slug='0d25afcb'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.7)
<p>Consider the instruction</p>

<pre><code>movq %rax, (%rcx)
</code></pre>

<p>As part of executing an instruction a last-level page table entry corresponding to the
value of <code>%rcx</code> will be retrieved.</p>

<p>Assume in addition to a valid bit, the page table entry contains a "writeable" bit,
an "executable" bit, and a "user-mode" bit, each of which indicate if that kind of memory access
can be completed using that page table entry.</p>

<p>The instruction will trigger an exception as a result of the page table lookup if ____.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>99%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='18a10628' disabled='disabled'/><div><p>the "valid" bit in that page table entry is 0</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>88%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='3e34c284' disabled='disabled'/><div><p>the "writeable" bit in that page table entry is 0</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>10%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='dbeb8762' disabled='disabled'/><div><p>the "executable" bit in that page table entry is 0</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>8%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='ea28ad2d' disabled='disabled'/><div><p>the physical page number in that  page table entry is 0</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='0d25afcb'/></form></details></div><div class="multiquestion"><p>Consider the following C program (which uses the POSIX API):</p>

<pre><code>// some needed #includes not shown
int global;
int main() {
    global = 0;
    printf("1"); fflush(stdout);
    pid_t p = fork();
    printf("2"); fflush(stdout);
    if (p == 0) {
        global = 3;
    } else {
        global = 4;
    }
    printf("%d", global); fflush(stdout);
    return 0;
}
</code></pre>

<p>For the following questions, assume:</p>

<ul>
<li><code>fork</code> and <code>printf</code> and <code>fflush</code> do not fail;</li>
<li><code>global</code> always has a valid page table entry pointing to its storage in both processes</li>
<li>in addition to valid bits, page table entries have permission bits for writing, execution, and user-mode accesses;</li>
</ul>
<div class='question' id='q4' slug='7ddef53a'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.42) (see above)
<p><code>12423</code> and <code>12324</code> are possible outputs of the above program.
How many other possible outputs are there?</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans4' disabled='disabled'/></div>Key: <tt>2</tt><div class='explanation'><p>12234 and 12243; the parent outputs 124 and the child outputs 23.</p>

<p>To figure out the possible outputs, let's consider where the child can output its characters. The earliest it can do it is immediately after the parent outputs the 1 (because of where the fork() is) and the latest is after it outputs 4. So our output "template" looks like  1[&#95;]2[&#95;]4[&#95;] where [&#95;] represents blanks where the child runs. We can either put "23" in exactly one slot (the child runs entirely in between two parent outputs); or we can put "2" in one slot and "3" in a later one.</p>

<p>This gives possibilities of 1[23]24, 12[23]4, 124[23], 1[2]2[3]4, 1[2]24[3], 12[2]4[3]. After accounting for some these appearing identical (since we can't distinguish the child writing 2 from the parent writing 2 generally), we have 12324, 12234, 12423, 12243 --- four possible outputs.</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='7ddef53a'/></form></details></div><div class='question' id='q5' slug='37fabaf6'><div class='description' id='d5'><strong>Question 5</strong> (3 pt; mean 2.78) (see above)
<p>Suppose the system the above program runs on uses copy-on-write to implement
fork. Immediately after the <code>fork</code>, ____.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>89%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='82c85b67' disabled='disabled'/><div><p>the page tables are setup so that writing to <code>global</code> would trigger an exception</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>97%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='0e0795fa' disabled='disabled'/><div><p>both processes have the same virtual address for <code>global</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>93%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='f2d542a0' disabled='disabled'/><div><p>both processes have the same physical address for <code>global</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='37fabaf6'/></form></details></div><div class='question' id='q6' slug='74df739f'><div class='description' id='d6'><strong>Question 6</strong> (3 pt; mean 2.78) (see above)
<p>Suppose the system the above program runs on uses copy-on-write to implement
fork. Suppose both the parent a child process completed their assignment
to <code>global</code> but have not yet started the following <code>printf</code> call.
Then, ____.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>7%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='2bd2050c' disabled='disabled'/><div><p>the page tables are setup so that writing to <code>global</code> would trigger an exception</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>91%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='b71f73a8' disabled='disabled'/><div><p>both processes have the same virtual address for <code>global</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>6%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='bcdb5132' disabled='disabled'/><div><p>both processes have the same physical address for <code>global</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='74df739f'/></form></details></div></div>
﻿
<h1 style='text-align:center'>quiz for week 6</h1><div class='directions'><p>Answer the following questions about the lecture material for this week.</p>
</div><div class='question' id='q1' slug='15f247fe'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.47)
<p>Consider the following C snippet (which uses the POSIX API):</p>

<pre><code>pid_t pids[3];
for (int i = 0; i &lt; 3; i += 1) {
    printf("A"); fflush(stdout);
    pids[i] = fork();
    if (pids[i] == 0) {
        /* child process */
        printf("%d", i); fflush(stdout);
        exit(0);
    }
    if (i &gt;= 1) {
        waitpid(pids[i-1], NULL, 0);
    }
}
printf("B"); fflush(stdout);
waitpid(pids[2], NULL, 0);
</code></pre>

<p>Assume that <code>fork</code> and <code>waitpid</code> do not fail (and that all needed header files
are included).</p>

<p>Some possible outputs of this snippet are <code>AA01AB2</code> and <code>AA0A12B</code> (where the <code>A</code>s and <code>B</code>s are outputted
by the parent process and the <code>0</code>, <code>1</code>, and <code>2</code> are outputted by one of the three child processes
created by the call to <code>fork()</code> in the loop.)</p>

<p>Which of the following are other <em>possible</em> outputs?
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>18%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='32709e3f' disabled='disabled'/><div><p><code>AAA01B2</code></p>
</div></label><div class='explanation'><p>need <code>0</code> printed before third <code>A</code> (because of waitpid() call when i = 1 in parent)</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>81%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='2a156b69' disabled='disabled'/><div><p><code>AA10A2B</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>12%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='e5ab4b55' disabled='disabled'/><div><p><code>A01AA2B</code></p>
</div></label><div class='explanation'><p>need two As printed before <code>1</code> (before fork() call can happen when i = 1).</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>97%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='544a2fbb' disabled='disabled'/><div><p><code>A0A1A2B</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='15f247fe'/></form></details></div><div class="multiquestion"><p>Consider the following incomplete C snippet (which uses the POSIX API):</p>

<pre><code>int input_fd = open("input.txt", O_RDONLY);
if (input_fd &lt; 0)
    handle_error();
pid_t pid = fork();

____________ /* 1 */
if (pid == 0) {
    ____________ /* 2 */
    const char *argv[] = {"./a.out", NULL};
    execv("./a.out", argv);
} else if (pid &gt; 0) {
    ____________ /* 3 */
    int status;
    if ((pid_t) -1 == waitpid(pid, &amp;status, 0)) {
        handle_error();
    }
}
</code></pre>

<p>In the snippet, <code>__________</code> represents a blank to be replaced with code to complete the snippet.</p>

<p>For the following questions, assume that this program containing this snippet is <strong>not</strong> called a.out, and that <code>open</code>, <code>fork</code>, <code>dup2,</code>execv<code>,</code>close<code>and</code>waitpid` do not fail.</p>

<p>This code is intended to run a program called <code>a.out</code>, which normally would take input from the terminal using <code>stdin</code>, and have it read its input from <code>input.txt</code></p>
<div class='question' id='q2' slug='a32bd572'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.48) (see above)
<p>In order to make <code>a.out</code> read from <code>input.txt</code> for its standard input, one could
add a call to <code>dup2</code> (like <code>dup2(input_fd, STDIN_FILENO)</code>) to one of the blanks above.
Where can it be added to achieve this? (Identify the blank by the number in the comment labeling it.)</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>½</div><input type='radio' name='ans2' value='34c24028' disabled='disabled'/><div><p>in blank 1</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>22%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>½</div><input type='radio' name='ans2' value='eaf8c99a' disabled='disabled'/><div><p>in blank 2</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='a83d77c0' disabled='disabled'/><div><p>in blank 3</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>76%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans2' value='15622297' disabled='disabled'/><div><p>in blank 1 or blank 2 (both work, but one might be a better choice than the other)</p>
</div></label><div class='explanation'><p>blank 2 is better, but blank 1 also works --- we just need to close input_fd in the parent to avoid wasting resources</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='81939461' disabled='disabled'/><div><p>in blank 1 or blank 3 (both work, but one might be a better choice than the other)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='518d3d20' disabled='disabled'/><div><p>in any of the blanks (any would work, though one might be a better choice than the others)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>0%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='6816a9a5' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='a32bd572'/></form></details></div><div class='question' id='q3' slug='627b38b1'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.33) (see above)
<p>Normally, we'd use a dup2 call like <code>dup2(input_fd, STDIN_FILENO)</code> to 
redirect <code>a.out</code>'s input. What would happen if we erroneously
used <code>dup2(STDIN_FILENO, input_fd)</code>? <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>11%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='0fd1f9ce' disabled='disabled'/><div><p>when <code>a.out</code> tries to read its stdin, it will fail or crash</p>
</div></label><div class='explanation'><p>the erroneous dup2 call does not change what a.out's stdin will be, so it will refer to the terminal from the terminal (or whatever the normal stdin was)</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>34%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='b21ea152' disabled='disabled'/><div><p>if code after the snippet above ran <code>close(input_fd)</code>, it would no longer be able to read its stdin</p>
</div></label><div class='explanation'><p>close() just makes the particular file descriptor point to nothing. So although this would make <code>input_fd</code> not useful, <code>STDIN_FILENO</code> would be unaffected by the close</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>90%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='eb6c28f8' disabled='disabled'/><div><p>if code after the snippet above attempted to read from its stdin, it would read from the same place it would if the <code>dup2</code> call was not made</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>13%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='347b31e2' disabled='disabled'/><div><p>if code after the snippet above attempted to read from <code>input_fd</code>, it would read from <code>input.txt</code></p>
</div></label><div class='explanation'><p><code>input_fd</code> would now refer to stdin, likely the terminal instead</p>
</div></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='627b38b1'/></form></details></div></div><div class='question' id='q4' slug='d7b4a397'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.57)
<p>In lecture, we mentioned that <em>temporal locality</em> is a property that a program
that accesses a value is likely to access that same value again soon.</p>

<p>Consider the following C snippet:</p>

<pre><code>for (int i = 0; i &lt; 1024; ++i) {
    printf("%s %s\n", A[i], B[i]);
}
</code></pre>

<p>The snippet would exhibit more <em>temporal</em> locality in its array accesses if ____. 
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>90%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='25e3c3a3' disabled='disabled'/><div><p><code>A[i]</code> were replaced with <code>A[i % 4]</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>88%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='feb9e7b3' disabled='disabled'/><div><p><code>B[i]</code> were replaced with <code>A[i]</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>90%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='7ae36198' disabled='disabled'/><div><p><code>B[i]</code> were replaced with <code>B[1023]</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>12%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='879e3a16' disabled='disabled'/><div><p>the <code>printf</code> was changed to print from 3 arrays: <code>printf("%s %s %s\n", A[i], B[i], C[i]);</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='d7b4a397'/></form></details></div><div class="multiquestion"><p>Consider a direct-mapped cache whose contents are as follows:</p>

<table>
<thead>
<tr><td>index (written in binary)</td><td>valid</td><td>tag (written in binary)</td><td>data (written as hexadecimal bytes, lowest address first)</td>
</thead>
<tbody>
<tr><td>00</td><td>1</td><td>1100</td><td>AB CD</td>
<tr><td>01</td><td>1</td><td>0110</td><td>EF 01</td>
<tr><td>10</td><td>1</td><td>1110</td><td>23 45</td>
<tr><td>11</td><td>0</td><td>&mdash;</td><td>&mdash;</td>
</tbody>
</table>
<div class='question' id='q5' slug='2ce87381'><div class='description' id='d5'><strong>Question 5</strong> (6 pt; mean 5.74) (see above)
<p>Based on the contents of the cache shown above, accessing which of the following addresses
would be a cache hit?
All the addresses are written in binary.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>5%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='c7e98e18' disabled='disabled'/><div><p>0001100</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='6c492254' disabled='disabled'/><div><p>0110111</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>94%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='540798fb' disabled='disabled'/><div><p>1100000</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>93%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='6f77a1ca' disabled='disabled'/><div><p>1100001</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='28eda262' disabled='disabled'/><div><p>1110000</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='be7ddcc5' disabled='disabled'/><div><p>1110111</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='2ce87381'/></form></details></div><div class='question' id='q6' slug='eda2530f'><div class='description' id='d6'><strong>Question 6</strong> (5 pt; mean 4.64) (see above)
<p>If a processor used this cache to read the byte value <code>0x99</code> from an address with index 01, tag 0000, and offset 1, then the cache would ____. <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='2d1f8670' disabled='disabled'/><div><p>store <code>0x99</code> as part of the data for index <code>11</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>93%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='8ce56ea8' disabled='disabled'/><div><p>replace the value <code>0x01</code> in the cache's data with something else</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>81%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='2541edc7' disabled='disabled'/><div><p>replace the value <code>0xEF</code> in the cache's data with something else</p>
</div></label><div class='explanation'><p>cache needs to read in whole block (get all bytes from addresses with that tag+index)</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>95%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='a8247d6d' disabled='disabled'/><div><p>replace the tag <code>0110</code> stored in the cache with something else</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='b2fa1b70' disabled='disabled'/><div><p>change a valid bit (from 0 to 1 or from 1 to 0)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='eda2530f'/></form></details></div></div>
﻿
<h1 style='text-align:center'>quiz for week 7</h1><div class='directions'></div><div class="multiquestion"><p>For the following questions, consider a 2-way set associative cache 
with an LRU (least recently used) replacement policy
whose contents are as follows.</p>

<p>In the cache contents below, indices and tags are written in binary, and
data bytes are written as a sequence of hexadecimal bytes with the lowest address first.</p>

<table>
<thead>
<tr><td></td><td colspan="3" style="border-top: 1pt solid black; border-right: 1pt solid black; border-left: 1pt solid black">way 0</td><td colspan="3" style="border-top: 1pt solid black; border-right: 1pt solid black; border-left: 1pt solid black">way 1</td>
<tr><td>index (written in binary)</td>
<td>valid</td><td>tag (written in binary)</td><td>data</td>
<td>valid</td><td>tag (written in binary)</td><td>data</td>
<td>LRU way</td>
</thead>
<tbody>
<tr><td>00</td>
<td>1</td><td>1100</td><td>AB CD</td>
<td>1</td><td>1101</td><td>DE EF</td>
<td>0</td>
<tr><td>01</td>
<td>1</td><td>0010</td><td>01 02</td>
<td>1</td><td>0011</td><td>03 04</td>
<td>1</td>
<tr><td>10</td>
<td>1</td><td>1110</td><td>23 45</td>
<td>0</td><td>&mdash;</td><td>&mdash;</td>
<td>1</td>
<tr><td>11</td>
<td>0</td><td>&mdash;</td><td>&mdash;</td>
<td>0</td><td>&mdash;</td><td>&mdash;</td>
<td>0</td>
</tbody>
</table>
<div class='question' id='q1' slug='983743c9'><div class='description' id='d1'><strong>Question 1</strong> (3 pt; mean 2.72) (see above)
<p>What is the address with index 00, tag 1101, and (block) offset 1 in the above cache?
Write your answer as a binary number.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans1' disabled='disabled'/></div>Key: <tt>1101001</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='983743c9'/></form></details></div><div class='question' id='q2' slug='3594991c'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.93) (see above)
<p>Using the above cache, <em>reading</em> a byte from an address with index 01, tag 0011, offset 0 will _____.
(Ignore effects from any changes in the other questions.)
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='8e57c1c7' disabled='disabled'/><div><p>change the value of an "LRU way" bit in this cache</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans2' value='fce96543' disabled='disabled'/><div><p>change the value of a valid bit in this cache (from 0 to 1 or 1 to 0)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans2' value='a875576a' disabled='disabled'/><div><p>change the value of some of the tag bits in this cache</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans2' value='0b97a14b' disabled='disabled'/><div><p>cause the cache to read something from the next level of cache or main memory (even if there are no other accesses to the above cache)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='3594991c'/></form></details></div><div class='question' id='q3' slug='fc187497'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.67) (see above)
<p>Using the above cache, <em>reading</em> a byte from an address with index 11, tag 1110, offset 0 will _____.
(Ignore effects from any changes in the other questions.)
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>90%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='996a1b92' disabled='disabled'/><div><p>change the value of an "LRU way" bit in this cache</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>96%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='953d005c' disabled='disabled'/><div><p>change the value of a valid bit in this cache (from 0 to 1 or 1 to 0)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>93%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='a6186d28' disabled='disabled'/><div><p>change the value of some of the tag bits in this cache</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>88%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='c3f10c2e' disabled='disabled'/><div><p>cause the cache to read something from the next level of cache or main memory (even if there are no other accesses to the above cache)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='fc187497'/></form></details></div></div><div class="multiquestion"><p>Suppose an array is declared as follows:</p>

<pre><code>unsigned char array[16];
</code></pre>

<p>which is located at a memory address that is
a multiple of 1024 (two to the tenth power).</p>

<p>and then we run the following C snippet:</p>

<pre><code>int count = 0;
count += array[0];
count += array[3];
count += array[6];
count /= array[1];
count /= array[4];
count /= array[7];
</code></pre>
<div class='question' id='q4' slug='42959e29'><div class='description' id='d4'><strong>Question 4</strong> (5 pt; mean 4.69) (see above)
<p>Suppose the above code snippet is run with a two-set direct-mapped
data cache with 2 byte blocks. [Note that unlike the examples in
lecture, the array elements take up 1 byte and the cache blocks
are smaller]</p>

<p>Accessing <code>array[0]</code> will use set 0 of this cache. Access which of the following
other array elements would also use set 0? <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>92%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='d3e84b6b' disabled='disabled'/><div><p><code>array[1]</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>5%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='c3a82a65' disabled='disabled'/><div><p><code>array[3]</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>95%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='576dde7c' disabled='disabled'/><div><p><code>array[4]</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>9%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='b4dd2a02' disabled='disabled'/><div><p><code>array[6]</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='e7cfdf5c' disabled='disabled'/><div><p><code>array[7]</code></p>
</div></label></li></ol><div class='explanation'><p>mapping to set is based on addresses; because array[0]'s address is a multiple of 1024 and therefore 2,  it is at the start of a 2-byte block. This block includes {array[0], array[1]}. The next block in memory is {array[2], array[3]}, and must map to the next set, set 1. After that {array[4], array[5]}, which would map to the next set, but since the cache only has two sets, this is set 0 instead of set 2. Then the next set {array[6], array[7]} maps to set 1.</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='42959e29'/></form></details></div><div class='question' id='q5' slug='2f5c52ed'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 3.38) (see above)
<p>Suppose the above code snippet is run with a two-set direct-mapped
data cache with 2 byte blocks.
Assume the cache is initially empty when the snippet starts and only accesses
to <code>array</code> use the cache.
How many cache misses will occur?</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans5' disabled='disabled'/></div>Key: <tt>4</tt><div class='explanation'><p>(showing {contents of set 0 in cache}{contents of set 1 in cache} after each miss is processed) array[0] M: {01}{--}; array[3] M: {01}{23}; array[6] M: {01}{67}; array[1] H; array [4] M: {45}{67}; array[7] H</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='2f5c52ed'/></form></details></div><div class='question' id='q6' slug='2ed69990'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.63) (see above)
<p>Suppose the above code snippet is run with a two-block fully associative
data cache with 2 byte blocks and an LRU (least recently used) replacement policy.
This cache could also
be described as a 2-way set associative cache with 1 set and 2-byte blocks
and an LRU replacement policy.
Assume the cache is initially empty when the snippet starts and only accesses
to <code>array</code> use the cache.
How many cache misses will occur?</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans6' disabled='disabled'/></div>Key: <tt>6</tt><div class='explanation'><p>(showing which blocks present in cache, most recently accessed block first) array[0] M: {01}{--}; array[3] M: {23}{01}; array[6] M: {67}{23}; array[1] M {01}{67}; array [4] M: {45}{01}; array[7] M {67}{45}</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='2ed69990'/></form></details></div></div>
﻿
<h1 style='text-align:center'>quiz for week 8</h1><div class='directions'></div><div class="multiquestion"><p>For the following questions, consider a 2-way set associative cache 
with an LRU (least recently used) replacement policy,
a write-back policy, and a write-allocate policy,
whose contents are as follows.</p>

<p>In the cache contents below, indices and tags are written in binary, and
data bytes are written as a sequence of hexadecimal bytes with the lowest address first.</p>

<table>
<thead>
<tr><td></td><td colspan="4" style="border-top: 1pt solid black; border-right: 1pt solid black; border-left: 1pt solid black">way 0</td><td colspan="4" style="border-top: 1pt solid black; border-right: 1pt solid black; border-left: 1pt solid black">way 1</td>
<tr><td>index (written in binary)</td>
<td>valid</td><td>tag (written in binary)</td><td>data</td><td>dirty</td>
<td>valid</td><td>tag (written in binary)</td><td>data</td><td>dirty</td>
<td>LRU way</td>
</thead>
<tbody>
<tr><td>00</td>
<td>1</td><td>1100</td><td>AB CD</td><td>1</td>
<td>1</td><td>1101</td><td>DE EF</td><td>0</td>
<td>0</td>
<tr><td>01</td>
<td>1</td><td>0010</td><td>01 02</td><td>0</td>
<td>1</td><td>0011</td><td>03 04</td><td>1</td>
<td>1</td>
<tr><td>10</td>
<td>1</td><td>1110</td><td>23 45</td><td>0</td>
<td>0</td><td>&mdash;</td><td>&mdash;</td><td>0</td>
<td>1</td>
<tr><td>11</td>
<td>0</td><td>&mdash;</td><td>&mdash;</td><td>0</td>
<td>0</td><td>&mdash;</td><td>&mdash;</td><td>0</td>
<td>0</td>
</tbody>
</table>
<div class='question' id='q1' slug='9005a42b'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.79) (see above)
<p>Using the above cache, <em>writing</em> a byte to an address with index 00, tag 1101, offset 1 will _____.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='030a1aa4' disabled='disabled'/><div><p>change the value of a dirty bit in this cache</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>11%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='2a258eef' disabled='disabled'/><div><p>change the value of an "LRU way" bit in this cache</p>
</div></label><div class='explanation'><p>modifying most recently used way of this set, so least recently used does not change</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='3fc981a8' disabled='disabled'/><div><p>cause the cache to read something from the next level of cache or main memory (even if there are no other accesses to the above cache)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='97a45b95' disabled='disabled'/><div><p>cause the cache to write somemthing to the next level of cache or main memory (even if there are no other accesses to the above cache)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='9005a42b'/></form></details></div><div class='question' id='q2' slug='2594cbbc'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.58) (see above)
<p>Using the above cache, <em>writing</em> a byte to an address with index 01, tag 1111, offset 0 will _____.
(Ignore effects from any changes in the other questions.)
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>23%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans2' value='315f2b12' disabled='disabled'/><div><p>change the value of a dirty bit in this cache</p>
</div></label><div class='explanation'><p>replaces something already dirty, so dirty bit remains at 1</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='6e012672' disabled='disabled'/><div><p>change the value of an "LRU way" bit in this cache</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>90%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='3c65f217' disabled='disabled'/><div><p>cause the cache to read something from the next level of cache or main memory (even if there are no other accesses to the above cache)</p>
</div></label><div class='explanation'><p>to read rest of this cache block (byte at address with index 01, tag 1111, offset 1)</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>93%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='292fec06' disabled='disabled'/><div><p>cause the cache to write something to the next level of cache or main memory (even if there are no other accesses to the above cache)</p>
</div></label><div class='explanation'><p>to write dirty bytes <code>03 04</code> (least recently used way)  back to memory</p>
</div></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='2594cbbc'/></form></details></div></div><div class='question' id='q3' slug='725e91c3'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.61)
<p>A system with:</p>

<ul>
<li>a 4-way set associative TLB with 128 entries.</li>
<li>5 index bits used in TLB lookups</li>
<li>4096-byte pages</li>
</ul>

<p>Suppose the virtual address <code>0x56123</code> translates to the physical address <code>0x43123</code>.
When a TLB lookup occurs as a part of accessing this virtual address,
which TLB index will be used?
Write your answer as a hexadecimal number.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans3' disabled='disabled'/></div>Key: <tt>0x16 -- early version of question had 32 entries instead of 128, so also accepted 0x6 (based on 3 index bits)</tt><div class='explanation'><p>TLB lookup uses virtual page 0x56; lower 5 bits are the TLB index</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='725e91c3'/></form></details></div><div class="multiquestion"><p>Consider the following C code which is run only by calling the <code>example()</code> function:</p>

<pre><code>struct thread_data {
    int x;
    int *p;
};

void *thread_func(void *raw_ptr) {
    struct thread_data *td;
    td = (struct thread_data *)raw_ptr;
    *(td-&gt;p) += td-&gt;x;      /* LINE A */
    td-&gt;x = *(td-&gt;p);       /* LINE B */
    return &amp;td-&gt;x;
}

int global_array[2] = {0, 0};

void example() {
    pthread_t threads[2];
    for (int x = 0; x &lt; 2; ++x) {
        struct thread_data *td;
        td = malloc(sizeof(struct thread_data));
        td-&gt;x = x;
        td-&gt;p = &amp;global_array[x];
        int ret = pthread_create(&amp;threads[x], NULL, thread_func, (void*) td);
        /* LINE C */
    }
    /* LINE D */
    for (int i = 0; i &lt; 2; ++i) {
        void *raw_ptr;
        pthread_join(threads[i], &amp;raw_ptr);
        int *p;
        p = (int*) raw_ptr;
        printf("got result %d\n", *p); /* LINE E */
    }
    /* LINE F */
}
</code></pre>

<p>The comments of the form "LINE X" are label particular parts of the code for the questions below.</p>

<p>Assume all appropriate <code>#include</code>s are used and the <code>example()</code> function is run
and the <code>example()</code> function is the only thing that causes <code>thread_func</code> to be called
or <code>global_array</code> to be accessed.</p>
<div class='question' id='q4' slug='af2a41d3'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.58) (see above)
<p>When <code>example()</code> causes the function <code>thread_func</code> to run, the line labeled <code>LINE B</code> modifies ____.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='047abbc5' disabled='disabled'/><div><p>a value on the stack of the thread that called <code>example()</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>9%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='5a37e876' disabled='disabled'/><div><p>a value on the stack of a thread created by <code>pthread_create()</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>89%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans4' value='a96ca74b' disabled='disabled'/><div><p>a value on the heap</p>
</div></label><div class='explanation'><p><code>td</code> is local variable on the stack of example(), but <code>td-&gt;x</code> is part of something malloc'd in <code>example()</code></p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>0%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='d6c1e11d' disabled='disabled'/><div><p>a global variable</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='54701365' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='af2a41d3'/></form></details></div><div class='question' id='q5' slug='fb5b2b4c'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 3.16) (see above)
<p>In the function <code>example()</code>, the line labeled LINE E prints out
an integer that is stored  ____.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>11%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='aecea2d0' disabled='disabled'/><div><p>on the stack of a thread created by the thread that called <code>example()</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>6%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='1eee6caf' disabled='disabled'/><div><p>on the stack of a thread created by <code>pthread_create()</code> in <code>example()</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>79%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans5' value='ebebec48' disabled='disabled'/><div><p>on the heap</p>
</div></label><div class='explanation'><p><code>p</code> is <code>&amp;td-&gt;x</code> because of what <code>thread_func</code> returns; <code>&amp;td-&gt;x</code> is a pointer to part of what's malloc'd earlier in example()</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='3f7746ce' disabled='disabled'/><div><p>in the region used for global and static variables</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>0%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='af2d8bbe' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='fb5b2b4c'/></form></details></div><div class='question' id='q6' slug='657c4237'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.66) (see above)
<p>The <code>example()</code> function in the above code
has a memory leak because the malloc call in the first for loop
in example() does not have any corresponding free calls.
Which of the following is the <em>earliest</em> that a <code>free</code> call or calls could be
safely added? (Assume that extra code is added to track the malloc'd pointers
so they can be freed.)</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>0%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='5254a14d' disabled='disabled'/><div><p>just after LINE A</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='a77e3584' disabled='disabled'/><div><p>just after LINE B</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='e8091c05' disabled='disabled'/><div><p>LINE C</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='ddb1cd41' disabled='disabled'/><div><p>LINE D</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>91%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans6' value='26892fa3' disabled='disabled'/><div><p>LINE F</p>
</div></label><div class='explanation'><p>because value from this malloc is printed on LINE E</p>
</div></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='657c4237'/></form></details></div></div>
﻿
<h1 style='text-align:center'>quiz for week 9</h1><div class='directions'></div><div class="multiquestion"><p>Consider the following code that uses mutexes:</p>

<pre><code>pthread_mutex_t int_lock = PTHREAD_MUTEX_INITIALIZER;
pthread_mutex_t ptr_lock = PTHREAD_MUTEX_INITIALIZER;

int global_int1 = 1;
int global_int2 = 2;
int global_int3 = 3;
int *global_ptr = &amp;global_int1;

void thread1() {
    int *old_pointer;
    pthread_mutex_lock(&amp;ptr_lock);
    old_pointer = global_ptr;
    global_ptr = &amp;global_int3;
    pthread_mutex_unlock(&amp;ptr_lock);        /* A */
    pthread_mutex_lock(&amp;int_lock);
    global_int2 += global_int1;
    pthread_mutex_unlock(&amp;int_lock);
    pthread_mutex_lock(&amp;ptr_lock);          /* A */
    old_pointer = global_ptr;
    global_ptr = old_pointer;
    pthread_mutex_unlock(&amp;ptr_lock);
}

void thread2() {
    pthread_mutex_lock(&amp;ptr_lock);

    pthread_mutex_lock(&amp;int_lock);          /* B */
    global_int1 += *global_ptr;         
    pthread_mutex_unlock(&amp;int_lock);        /* B */
                                            /* C */
    global_ptr = &amp;global_int2;
    pthread_mutex_unlock(&amp;ptr_lock);
}
</code></pre>

<p>For the following questions, assume that <code>thread1</code> and <code>thread2</code> are started at the same time
from different threads and run exactly once, and no other
code manipulates the global variables above.</p>
<div class='question' id='q1' slug='17b1d4fb'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.43) (see above)
<p>Removing the lock and unlock call marked with the comment <code>/* B */</code>
would ____. <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='3bd39136' disabled='disabled'/><div><p>allow a deadlock to occur when one was not previously possible</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>36%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='53e56391' disabled='disabled'/><div><p>ensure that thread1() does not wait for thread2() to unlock a lock</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>95%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='f56ab38b' disabled='disabled'/><div><p>change what values are possible to see in <code>global_int1</code>, <code>global_int2</code>, and/or <code>global_int3</code> (when both threads finish)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='17b1d4fb'/></form></details></div><div class='question' id='q2' slug='8c434715'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 4) (see above)
<p><s>It's possible for <code>global_ptr</code>'s final value to be <code>&amp;global_int1</code>
despite <code>thread2</code>'s code setting to <code>&amp;global_int2</code>.
Which of the following changes would prevent that? <strong>Select all that apply.</strong></s></p>

<p>[Question dropped due to error in code above.]</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>35%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans2' value='fc4f003f' disabled='disabled'/><div><p>add <code>pthread_mutex_unlock(&amp;ptr_lock); pthread_mutex_lock(&amp;ptr_lock);</code> at the line marked with the comment <code>/* C */</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>48%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans2' value='21747a43' disabled='disabled'/><div><p>remove <code>int_lock</code> by replacing all uses of <code>int_lock</code> with <code>ptr_lock</code> in thread1() and removing the locks and unclocks of <code>int_lock</code> in thread2 (marked with <code>/* B */</code>)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>52%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤ (accepted any answer)</div><input type='checkbox' name='ans2' value='2ca56a19' disabled='disabled'/><div><p>remove the <code>pthread_mutex_lock</code> and <code>pthread_mutex_unlock</code>s marked with the comment <code>/* A */</code></p>
</div></label></li></ol><div class='explanation'><p>Gave everyone full credit for this question, since it did not make sense due to an error. I intended to ask the question without the <code>old_pointer = global_ptr</code> line repeated. With it repeated, <code>global_ptr</code> cannot be <code>&amp;global_int1</code>.</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='8c434715'/></form></details></div></div><div class="multiquestion"><p>Consider the following code that uses barriers and mutexes:</p>

<pre><code>pthread_barrier_t barrier;
pthread_mutex_t lock;
int x = 1, y = 2, z = 3;

void *thread1_func(void *) {
    pthread_mutex_lock(&amp;lock);      /* LOCK A */
    y += z; 
    pthread_mutex_unlock(&amp;lock);    /* UNLOCK A */
    pthread_barrier_wait(&amp;barrier);
    pthread_mutex_lock(&amp;lock);      /* LOCK B */
    x += z;
    pthread_mutex_unlock(&amp;lock);    /* UNLOCK B */
    pthread_barrier_wait(&amp;barrier);
}

void *thread2func(void *) {
    pthread_mutex_lock(&amp;lock);      /* LOCK C */
    y += z;
    pthread_mutex_unlock(&amp;lock);    /* UNLOCK C */
    pthread_barrier_wait(&amp;barrier);
    pthread_mutex_lock(&amp;lock);      /* LOCK D */
    y += z;
    pthread_mutex_unlock(&amp;lock);    /* UNLOCK D */
    pthread_barrier_wait(&amp;barrier);
    pthread_mutex_lock(&amp;lock);      /* LOCK E */
    x += z;
    pthread_mutex_unlock(&amp;lock);    /* UNLOCK E */
}

int main() {
    pthread_barrier_init(&amp;barrier, 2);
    pthread_mutex_init(&amp;lock, NULL);
    pthread_t thread1;
    pthread_t thread2;
    pthread_create(&amp;thread1, NULL, thread1_func, NULL);
    pthread_create(&amp;thread2, NULL, thread2_func, NULL);
    pthread_join(thread1, NULL);
    pthread_join(thread2, NULL);
    printf("%d %d %d\n", x, y, z);
    return 0;
}
</code></pre>
<div class='question' id='q3' slug='794e2004'><div class='description' id='d3'><strong>Question 3</strong> (5 pt; mean 4.61) (see above)
<p>Each of the calls to <code>pthread_mutex_lock</code> and <code>pthread_mutex_unlock</code> above are labeled
LOCK X or UNLOCK X where X is a letter.
Which (if any) of them could be removed without causing a race condition?
(That is, without making the values of <code>x</code>, <code>y</code>, and <code>z</code> vary depending on the relative timing
of threads.)
(Assume that only matching pairs of locks and unlocks would be removed.)
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>8%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='4fd3f892' disabled='disabled'/><div><p>LOCK A and UNLOCK A</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>91%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='042d2db6' disabled='disabled'/><div><p>LOCK B and UNLOCK B</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>9%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='a40ceda7' disabled='disabled'/><div><p>LOCK C and UNLOCK C</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>92%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='fa862c05' disabled='disabled'/><div><p>LOCK D and UNLOCK D</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>94%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='5e06d2ae' disabled='disabled'/><div><p>LOCK E and UNLOCK E</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='794e2004'/></form></details></div><div class='question' id='q4' slug='d0ab853d'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.78) (see above)
<p>The <code>printf</code> in <code>main()</code> avoids race conditions and always outputs the final values
of <code>x</code>, <code>y</code>, and <code>z</code>. This would also happen if the printf were placed ____. <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='8ac7435d' disabled='disabled'/><div><p>anywhere in <code>main()</code> after the second <code>pthread_create</code> call</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>10%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='82636a0e' disabled='disabled'/><div><p>anywhere in <code>main()</code> after the first <code>pthread_join</code> call</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='3f122b49' disabled='disabled'/><div><p>at the end of <code>thread1func</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>94%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='14da72b2' disabled='disabled'/><div><p>just before UNLOCK E in <code>thread2func</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='d0ab853d'/></form></details></div></div><div class="multiquestion"><p>Suppose we have a system for booking plane flights. 
This system needs to support booking a single ticket that encompasses multiple
plane flights.
To support this, the system, implemented in C with pthreads, uses the
following data structures:</p>

<pre><code>struct flight {
    pthread_mutex_t lock;
    int flight_id;
    int remaining_seats;
    struct tickets *tickets[MAX_SEATS];
};

struct ticket {
    int ticket_number;
    int num_flights;
    struct flight *flights[MAX_FLIGHTS];
};
</code></pre>

<p>The support booking and cancelling tickets, the system implements
the following functions:</p>

<ul>
<li><p><code>struct ticket *BookTicket(int num_flights, struct flight *flights)</code> --- books a ticket
for the specified flights, or returns NULL if this is not possible due to insufficient
remaining seats</p></li>
<li><p><code>int ChangeTicket(struct ticket *ticket, int index, struct flight *new_flight)</code> ---
change the <code>index</code>'th flight (counting starting with 0) on the ticket <code>ticket</code> to
<code>new_flight</code>. Return 0 if this is not possible due to insufficient remaining seats;
otherwise return 1.</p></li>
</ul>

<p>Psuedocode for these functions are as follows. Assume the
<code>AddTicketToFlight</code> and <code>RemoveTicketFromFlight</code> functions handle adjusting <code>remaining_seats</code>.</p>

<pre><code>struct ticket *BookTicket(int num_flights, struct flight *flights) {
    int can_book = 1;
    for (int i = 0; i &lt; num_flights; i += 1) {
        pthread_mutex_lock(&amp;flights[i]-&gt;lock);
        if (flights[i]-&gt;remaining_seats == 0) {
            can_book = 0;
        }
    }
    struct ticket *result;
    if (can_book) {
        result = AllocateTicket(num_flights, flights);
        for (int i = 0; i &lt; num_flights; i += 1) {
            AddTicketToFlight(result, flights[i]);
        }
    }
    for (int i = 0; i &lt; num_flights; i += 1) {
        pthread_mutex_unlock(&amp;flights[i]-&gt;lock);
    }
    return result;
}

int ChangeTicket(struct ticket *ticket, int index, struct flight *new_flight) {
    int successful = 0;
    pthread_mutex_lock(&amp;new_flight-&gt;lock);
    if (new_flight-&gt;remaining_seats &gt; 0) {
        pthread_mutex_lock(&amp;ticket-&gt;flights[index]-&gt;lock);
        RemoveTicketFromFlight(ticket-&gt;flights[index]);
        ticket-&gt;flights[index] = new_flight;
        AddTicketToFlight(ticket, new_flight);
        pthread_mutex_unlock(&amp;ticket-&gt;flights[index]-&gt;lock);
        successful = 1;
    }
    pthread_mutex_unlock(&amp;new_flight-&gt;lock);
    return successful;
}
</code></pre>
<div class='question' id='q5' slug='182246a1'><div class='description' id='d5'><strong>Question 5</strong> (5 pt; mean 4.7) (see above)
<p>If precautions are not taken, multiple simultaneous calls to BookTicket can deadlock.
Which of the following are <strong>sufficient</strong> adjustments to prevent the deadlock?
<strong>Select all that apply.</strong></p>

<p>For this question:</p>

<ul>
<li>assume ChangeTicket is not in use; and</li>
<li>ignore the trivial deadlock that occurs when the same flight is listed
multiple times in a single call to BookTicket; only consider deadlocks that involve
multiple calls to BookTicket.</li>
</ul>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>93%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='aa03eaa8' disabled='disabled'/><div><p>before calling BookTicket, sort the array of flights by flight_id (assuming there are no duplicate flight_ids)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>9%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='f8945db5' disabled='disabled'/><div><p>in the first for loop in BookTicket, break out of the loop early if <code>flights[i]-&gt;remaining_seats == 0</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>8%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='27fd3d91' disabled='disabled'/><div><p>when <code>can_book</code> is true, call <code>pthread_mutex_unlock(&amp;flights[i]-&gt;lock)</code> immediately after <code>AddTicketToFlight(result, flights[i])</code> instead of later</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='3d703583' disabled='disabled'/><div><p>never call BookTicket with <code>num_flights</code> greater than 2</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>95%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='4118ded3' disabled='disabled'/><div><p>require every call to BookTicket to specify only flights not specified by any other active call to BookTicket</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='182246a1'/></form></details></div><div class='question' id='q6' slug='699337ab'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.52) (see above)
<p>It's possible for a simulatenous call to ChangeTicket and BookTicket to deadlock
(even when those calls would not deadlock if they occurred separately and
when there are no other functions manipulating the tickets and flights).
Which of the following
are examples of calls that <em>could</em> trigger this deadlock? <strong>Select all that apply.</strong></p>

<p>In the psuedocode below <code>A</code>, <code>B</code>, etc. represent distinct flights, <code>{X, Y, Z}</code> represents
an array of flights <code>X</code>, <code>Y</code>, and <code>Z</code>, and <code>&lt;X, Y&gt;</code> represents a ticket whose
flights are <code>X</code> and <code>Y</code>.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>97%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='08efcc2c' disabled='disabled'/><div><p><code>BookTicket(2, {A, B})</code> and <code>ChangeTicket(&lt;A&gt;, 0, B)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>35%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='35887164' disabled='disabled'/><div><p><code>BookTicket(2, {A, B})</code> and <code>ChangeTicket(&lt;B&gt;, 0, A)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='759b618f' disabled='disabled'/><div><p><code>BookTicket(2, {A, B})</code> and <code>ChangeTicket(&lt;B, A, C&gt;, 2, D)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>94%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='dac313fe' disabled='disabled'/><div><p><code>BookTicket(3, {A, B, C})</code> and <code>ChangeTicket(&lt;A&gt;, 0, C)</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='699337ab'/></form></details></div></div>
﻿
<h1 style='text-align:center'>quiz for week 10</h1><div class='directions'></div><div class="multiquestion"><p>Consider a server where users connect to the server
and receive messages from a list of announcements.
The server implementation uses one thread for each connected user,
and in addition has another thread that adds messages
Each user is part of a single "channel" that has a message history.
These are represented using structs as follows:</p>

<pre><code>const char *messages[MAX_MESSAGES];
int last_message_index = -1;
struct User users[NUM_USERS];
pthread_mutex_t message_lock;
pthread_cond_t new_message_cv;

struct User {
    int last_read_message_index; /* initially -1 */
};
</code></pre>

<p>When adding a message to the list of announcements, the server calls
an <code>AddMessage</code> function. The threads representing user connections
repeatedly calls a function called <code>GetNextMessage</code> to wait for and return a next message.</p>

<p>Partial  implementations of these functions is shown below (where a blank written
with underscores like <code>__________</code> represents some omitted code):</p>

<pre><code>void AddMessage(const char *message) {
    pthread_mutex_lock(&amp;message_lock);
    last_message_index += 1;
    messages[last_messsage_index] = message;

    ________________________________________________        /* BLANK 1 */
    pthread_mutex_unlock(&amp;message_lock);
}

const char *GetNextMessage(struct User *user) {
    pthread_mutex_lock(&amp;message_lock);

    while (___________________________________________________) {       /* BLANK 2 */
        pthread_cond_wait(&amp;new_message_cv, &amp;message_lock);             
    }
    user-&gt;last_read_message_index += 1;
    const char *result = messages[user-&gt;last_read_message_index];
    pthread_mutex_unlock(&amp;message_lock);
    return result;
}
</code></pre>
<div class='question' id='q1' slug='88ad8d52'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.82) (see above)
<p>What code would be most appropriate to place in the blank marked with the comment <code>BLANK 1</code>?</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='1452a90d' disabled='disabled'/><div><p><code>for (int i = 0; i &lt; NUM_USERS; i += 1) users[i].last_read_message_index += 1;</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='66143a78' disabled='disabled'/><div><p><code>for (int i = 0; i &lt; NUM_USERS; i += 1) pthread_cond_signal(&amp;users[i].last_read_message_index);</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>96%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans1' value='30df9c30' disabled='disabled'/><div><p><code>pthread_cond_broadcast(&amp;new_message_cv)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='a8ca7ddd' disabled='disabled'/><div><p><code>pthread_cond_signal(&amp;new_message_cv)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>0%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='02f7426c' disabled='disabled'/><div><p><code>ptherad_cond_wait(&amp;new_message_cv, &amp;message_lock)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='2e574a55' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='88ad8d52'/></form></details></div><div class='question' id='q2' slug='94862b16'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.49) (see above)
<p>What code would be most appropriate to place in the blank marked with the comment <code>BLANK 2</code>?</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='98b1377f' disabled='disabled'/><div><p><code>last_message_index == -1</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='f68b9aa2' disabled='disabled'/><div><p><code>pthread_cond_signal(&amp;new_message_cv)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>0%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='cd60cbc7' disabled='disabled'/><div><p><code>pthread_cond_wait(&amp;users[i].last_read_message_index, &amp;new_message_cv)</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='7619f038' disabled='disabled'/><div><p><code>user-&gt;last_read_message_index != last_message_index</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>87%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans2' value='7a53541a' disabled='disabled'/><div><p><code>user-&gt;last_read_message_index == last_message_index</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>7%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='2c0811b4' disabled='disabled'/><div><p><code>user-&gt;last_read_message_index &lt; last_message_index</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='3073126d' disabled='disabled'/><div><p><code>user-&gt;last_read_message_index == -1</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='6c24e905' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='94862b16'/></form></details></div></div><div class='question' id='q3' slug='68b7e95e'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.59)
<p>Consider a scheme for sending a message from machine A to machine B
using unreliable messages like the one we discussed in lecture:</p>

<ul>
<li>machine B sends an acknowledgment to machine A whenever it receives a message</li>
<li>if no acknowledgment of a message is received after a long time, machine A resends that message</li>
</ul>

<p>Suppose we use this scheme to transmit a message
and the network is <em>very</em> unreliable: specifically,
it loses the every other message machine A sends, starting with the first;
and also loses every third message machine B sends, starting with the first.</p>

<p>Assume, however, that the network does not corrupt messages and when messages are not
lost they are received quickly.</p>

<p>How many messages will machine A send as part of its effort to transmit this data?
If A will never finish sending messages, write "infinity".</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans3' disabled='disabled'/></div>Key: <tt>4</tt><div class='explanation'><p>A -> B: part 1 (lost); A -> B: part 1; B -> A: ACK part 1 (lost); A -> B: part 1 (lost); A -> B: part 1; B -> A: ACK part 1</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='68b7e95e'/></form></details></div><div class="multiquestion"><p>As part of retrieving a web page from a remote web
server, a machine running a web browser will
send an acknowledgment to the remote web server.</p>

<p>To send this, the machine running the web browser
will send an Ethernet frame on its local network,
that contains a IP packet, which contains a TCP
segment.</p>
<div class='question' id='q4' slug='687204ef'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.31) (see above)
<p>The frame that the machine running the web browser
sends on its local network for this acknowledgment
will contain as its <em>destination</em> MAC address ____.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='632f668d' disabled='disabled'/><div><p>an identifier for the machine running the web browser</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>10%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='2b15a9b4' disabled='disabled'/><div><p>an identifier for the machine running the web server</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>83%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans4' value='ae6e587a' disabled='disabled'/><div><p>an identifier for a router that is on the same local network as the machine running the web browser</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>6%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='6f5cba21' disabled='disabled'/><div><p>an identifier for a router that is on the same local network as the machine running the web server</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='e403b970' disabled='disabled'/><div><p>an identifier for some other router</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans4' value='5da57305' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='687204ef'/></form></details></div><div class='question' id='q5' slug='d1ad7ee5'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 3.38) (see above)
<p>The frame that the machine running the web browser
sends on its local network for this acknowledgment
will contain as its <em>destination</em> IP address ____.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>0%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='fd42f6cf' disabled='disabled'/><div><p>an identifier for the machine running the web broswer</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>84%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans5' value='415e4313' disabled='disabled'/><div><p>an identifier for the machine running the web server</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='7c7f2c1f' disabled='disabled'/><div><p>an identifier for a router that is on the same local network as the machine running the web browser</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>14%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='7b6adf1b' disabled='disabled'/><div><p>an identifier for a router that is on the same local network as the machine running the web server</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='db022263' disabled='disabled'/><div><p>an identifier for some other router</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans5' value='96aeab37' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='d1ad7ee5'/></form></details></div><div class='question' id='q6' slug='0bc04b99'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.7) (see above)
<p>The frame that the machine running the web browser
sends on its local network for this acknowledgment
will contain as its <em>source</em> port number ____.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>92%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans6' value='f627da9e' disabled='disabled'/><div><p>an identifier for the web browser program</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='46df0283' disabled='disabled'/><div><p>an identifier for the web browser machine's kernel subroutine that handles sending acknowledgments</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='7b52ec00' disabled='disabled'/><div><p>an identifier for the web server program</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='418c4560' disabled='disabled'/><div><p>an identifier for the web server machine's kernel subroutine that handles sending acknowledgments</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans6' value='b1e4cd54' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='0bc04b99'/></form></details></div></div>
﻿
<h1 style='text-align:center'>quiz for week 11</h1><div class='directions'></div><div class='question' id='q1' slug='22192a6d'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.53)
<p>In lecture we discussed how when contacting a webserver like <code>kytos02.cs.virginia.edu</code>,
several DNS servers are involved --- typically one or more a local DNS server run by the local ISP, 
DNS server(s) for <code>cs.virginia.edu</code>,
server(s) for <code>virginia.edu</code>, and server(s) for <code>.edu</code>, and one for the root of the DNS hierarchy.
If all the DNS servers for <code>virginia.edu</code> become inaccessible , then we would expect 
accessing web pages on <code>kytos02.cs.virginia.edu</code> from a machine outside UVa ___.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>17%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='2112ef27' disabled='disabled'/><div><p>to stop working (from any such machine) shortly after the outage starts</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>65%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans1' value='18cffee7' disabled='disabled'/><div><p>to stop working (from any such machine) but only a considerable amount of time after the outage starts</p>
</div></label><div class='explanation'><p>also accepted</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>72%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans1' value='9772aab0' disabled='disabled'/><div><p>to work from some machines but not others shortly after the outage starts</p>
</div></label><div class='explanation'><p>best answer --- work from machines whose ISP's DNS server has it cached for a while until that cached version expires</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='ca298f53' disabled='disabled'/><div><p>to continue to work as it did before the outage (as long as the other servers are still up)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='a3fb9038' disabled='disabled'/><div><p>to continue to work, but be considerably slower</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans1' value='428f06a7' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><div class='explanation'><p>was accidentally set as select-all-that-apply, but not intended</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='22192a6d'/></form></details></div><div class='question' id='q2' slug='210753a7'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.56)
<p>Let's say two machines A and B connected to the same wifi network are erroneously configured to have
the same IP address 10.1.2.3.
When a third machine C on the same wifi network attempts to send a message to 10.1.2.3,
the message is only received by machine A. What most likely happened?</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='339918a7' disabled='disabled'/><div><p>machine C sent the message over wifi to everyone on the wifi network, but radio interference prevented machine B from getting it, and since machine C got an acknowledgment of the message from machine A, it did not try resending it</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='278d35e7' disabled='disabled'/><div><p>the message was discarded by a router, for example, because the router ran out of space to hold packets it was waiting to forward</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='c492bc96' disabled='disabled'/><div><p>when a router constructed its routing table, it learned about machine A having the IP address 10.1.2.3 first, and so only forwarded the message on a network connection for machine A</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>89%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans2' value='3c7501d2' disabled='disabled'/><div><p>when machine C asked for the MAC address for 10.1.2.3, it received the reply for machine A first and so used that as the destination MAC address when sending the message in a wifi frame</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>8%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans2' value='a5eecb41' disabled='disabled'/><div><p>when the wifi network's local router asked for the MAC address for 10.1.2.3, it received the reply for machine A first and so used that as the destination MAC address when forwarding the message</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='210753a7'/></form></details></div><div class="multiquestion"><p>For the following questions assume that:</p>

<ul>
<li>A and B know each other's public keys;</li>
<li>A and B have a shared encryption key (used for symmetric, non-public-key encryption) and a shared MAC (message authentication code) key;</li>
<li>an attacker who can act as an eavesdropper and machine-in-the-middle is active on the network but does not have access to any non-public keys; and</li>
<li>the encryption and MAC algorithms used are secure (no one without the appropriate key can decrypt or create a correct message authentication code)</li>
</ul>
<div class='question' id='q3' slug='14dc4231'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.51) (see above)
<p>Suppose A receives a packet on the network with a destination of A and a source of B,
and the packet contains:</p>

<ul>
<li>a name;</li>
<li>data generated by encrypting the string "The number chosen is 1923437." with the shared encryption key</li>
<li>a message authentication code generated using the shared MAC key and the name</li>
</ul>

<p>In this situation, A can be assured that ____. <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>92%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='18fcf2d3' disabled='disabled'/><div><p>either A or B used the name in the message (and not some other name) to generate the message authentication code</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>30%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='4fb106c0' disabled='disabled'/><div><p>no attacker could have changed the number in the message from what was originally encrypted by A or B</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>8%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='64efe007' disabled='disabled'/><div><p>no attacker who intercepted the packet would be able to read the message's name as a result</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>96%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='0a77cb89' disabled='disabled'/><div><p>no attacker who intercepted the packet would be able to identify that the chosen number was 1923437 as a result</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='14dc4231'/></form></details></div><div class='question' id='q4' slug='5d7aa518'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.49) (see above)
<p>Suppose A receives a packet on the network with a destination of A and a source of B, and
the packet contains message encrypted with A's public key, and having as its contents:</p>

<ul>
<li>a timestamp</li>
<li>B's public encryption key and</li>
<li>other data</li>
</ul>

<p>In this situation,
A can be assured that ____. <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='42434416' disabled='disabled'/><div><p>the "other data" in the message was generated after the timestamp</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>35%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='3a9ffc48' disabled='disabled'/><div><p>B had access to the "other data" in the message</p>
</div></label><div class='explanation'><p>"other data" could have been produced by corrupting whatever A/B originally encrypted</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>92%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='992dce64' disabled='disabled'/><div><p>no attacker who intercepted the packet would be able to read the message's timestamp as a result</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>94%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='3aeab8b3' disabled='disabled'/><div><p>no attacker who intercepted the packet would be able to read the message's "other data" as a result</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='5d7aa518'/></form></details></div><div class='question' id='q5' slug='30945a22'><div class='description' id='d5'><strong>Question 5</strong> (5 pt; mean 4.36) (see above)
<p>Suppose B manages a popular concert venue and trusts A to handle selling tickets for it. B receives information
about what tickets are booked from A, and intends to use the shared encryption and MAC key to send this
information over the network without the attacker being able to fraudalently book additional tickets.</p>

<p>B receives messages from A with a reports of sold ticket, containing:</p>

<ul>
<li>the ticket holder's name</li>
<li>the seat number, encrypted with the shared encryption key</li>
<li>the concert date</li>
<li>the price for which A sold the ticket, encrypted with the shared encryption key</li>
<li>a message authentication code generated using the shared MAC key and the seat number and the concert date</li>
</ul>

<p>B always recomputes that the message authentication code to verify that it matches the
rest of the data in the message, and if it does not, B ignores the message and alerts A to the problem.</p>

<p>Which of the following can the machine-in-the-middle attacker do to disrupt
the information B receives (without B detecting something is wrong)? <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>89%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='8d510e00' disabled='disabled'/><div><p>assign a ticket A is selling to a name A never sold a ticket for</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='d77f85c3' disabled='disabled'/><div><p>change the reported seat number of a ticket that A sold to a seat number A never sold a ticket for</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>8%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='e34343f7' disabled='disabled'/><div><p>change the reported concert date of a ticket that A sold to a concert date A never sold a ticket for</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>70%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='775b6795' disabled='disabled'/><div><p>change the reported price of a ticket that A sold</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>87%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='16a9ac03' disabled='disabled'/><div><p>make B unaware of a ticket that A sold and sent a record of to B</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='30945a22'/></form></details></div></div><div class='question' id='q6' slug='aba54f8f'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.31)
<p>Suppose A and B want to communicate over an insecure network to agree about what to order for lunch.</p>

<p>They arrange to share public encryption and public signing keys,
and decide to use the following [broken] protocol:</p>

<ul>
<li>A sends B a message encrypted using B's public encryption key containing A's proposed order</li>
<li>B sends A back a message signed using B's private signing key
stating "YES" if A's proposed order was acceptable and "NO" otherwise.</li>
<li>If A gets back a "YES" response, A makes an order. Otherwise, A repeats the process until
B's accepts an order.</li>
</ul>

<p>An attacker with sufficient control over the network (but who cannot interfere with A and B sharing
their public keys securely) can interfere with the protocol to do which of the following?
<strong>Selcet all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>5%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='67dc07f7' disabled='disabled'/><div><p>They can learn the contents of any rejected orders</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>69%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='2eede426' disabled='disabled'/><div><p>They can make it appear that B replied "YES" to a different proposed order than B actually replied to</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>90%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='6d784d86' disabled='disabled'/><div><p>They can make it appear that B replied "NO" to more proposed orders than B actually replied NO to</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>76%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='a5a47bb4' disabled='disabled'/><div><p>They can replace A's proposed order with one of their own without A being able to tell from the message's A receives</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='aba54f8f'/></form></details></div>
﻿
<h1 style='text-align:center'>quiz for week 12</h1><div class='directions'><p>Answer the following questions about the lecture material for this week.</p>
</div><div class='question' id='q1' slug='8cb684b1'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.78)
<p>One application of digital signatures is to support hardware "tokens"
as an alternative or supplement to passwords. For example, users might
be given a small device (called a "token")
that plugs into a USB port that contains
a low-power processor and a private key. To login to a computer,
they would plug this device into that machine's USB port,
Then, the computer would send a login request to the token, and
the token would send back a digital signature of the request.
The computer would verify the signature and permit the login accordingly.</p>

<p>In order to verify the signature, suppose the computer uses certificates.</p>

<p>Which of the following would be appropriate way to use certificates in this case? <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>88%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans1' value='4a141013' disabled='disabled'/><div><p>configure the hardware token in advance with a certificate, containing its public key, the identity of the user it is for, and signed by a certificate authority's public key, and have it send that certificate alongside the signed login request</p>
</div></label><div class='explanation'><p>would be true if read "signed by a certificate authority's private key" or "that can be verified with the certificate authority's public key" (which was what I intended, but not what I wrote); not true because of this error as written</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>7%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='3ebea0e1' disabled='disabled'/><div><p>generate a new certificate containing the public key of a certificate authority and the identity of the hardware token's user and signed by the token's private key, and send that alongside the signed login request</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>14%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='655df82f' disabled='disabled'/><div><p>have the hardware token generate a new certificate, containing its public key and the identity of the user the token is for, and a copy of the login request and signed by its private key, and send it alongside the signed login request</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='5ee3808c' disabled='disabled'/><div><p>rather than sending a signed login request, generate a certificate containing the computer's public key (which the computer will need to send in addition to the login request) as well as the identity of the hardware token's user and send that back the computer</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='8cb684b1'/></form></details></div><div class='question' id='q2' slug='f3963c99'><div class='description' id='d2'><strong>Question 2</strong> (5 pt; mean 4.78)
<p>Consider the following insecure scheme for sending "secure" emails from A to B.</p>

<p>A and B share an (symmetric) encryption key. When A wants to send an email to B,
A takes a cryptographic hash of their email's text.
Then, they send an encrypted version of their email's text, followed by the
cryptographic hash.</p>

<p>When B receives the email, B decrypts the text, and recomputes the hash value.
If the hash value B recomputes does not match, B rejects the message as tampered
with and discards it silently.</p>

<p>Which of the following attacks does this scheme allow, assuming the encryption
algorithm and cryptographic hash themselves are secure?
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans2' value='55cb9a17' disabled='disabled'/><div><p>an attacker can compute the encryption key from what A sends since the original text of the message is hashed instead of the result of encrypting the message</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>99%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='ba6fe776' disabled='disabled'/><div><p>an attacker can resend a previous message that A sent without B being able to tell that A did not resend the message themselves</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>83%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans2' value='0ba4d654' disabled='disabled'/><div><p>an attacker who guesses the message's text can verify that their guess is correct (without knowing the encryption key)</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>10%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤ (accepted any answer)</div><input type='checkbox' name='ans2' value='ec575537' disabled='disabled'/><div><p>an attacker who guesses the email's text (and doesn't have access to the encryption key) can tamper with the email's text without B knowing</p>
</div></label><div class='explanation'><p>assuming encryption scheme allows them to know how their tampering affects the message --- can change hash to hash for tampered message</p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>51%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤ (accepted any answer)</div><input type='checkbox' name='ans2' value='27453b45' disabled='disabled'/><div><p>an attacker with sufficient control over the network can prevent A from receiving the email from B successfully</p>
</div></label><div class='explanation'><p>intended to write "prevent B from receivin email from A"; scheme did not address sending messages in the other direction, but the attacker could also prevent that</p>
</div></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='f3963c99'/></form></details></div><div class='question' id='q3' slug='15a4cbce'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.9)
<p>A typical TLS handshake includes signing a cryptographic
hash of prior messages with a long-term public key from
the server.</p>

<p>A client that fails to verify this signature may ____.
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>7%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans3' value='fb01fb9b' disabled='disabled'/><div><p>allow an attacker who knows symmetric keys from a prior session to decrypt the current session</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>97%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤ (accepted any answer)</div><input type='checkbox' name='ans3' value='57e4abc7' disabled='disabled'/><div><p>not be able to tell if it performed the handshake with a server it did not intend to contact</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>38%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> (accepted any answer)</div><input type='checkbox' name='ans3' value='4c9a77c3' disabled='disabled'/><div><p>not obtain symmetric encryption keys to use for the rest of the connection</p>
</div></label><div class='explanation'><p>the clients would be able to complete the key exchange operation, which is what I intended to test with this question. I see that a number of students read it as the clients being unable to know that the keys were correct, so gave credit for either answer.</p>
</div></li></ol><div class='explanation'><p>This question's wording confused two separate operations in the handshake --- signing of the key share, and a Finished message which is created using a MAC over the prior handshake messages. I think the problem with either case is B --- but the reason why for the case where this is just the MAC is more that the handshake could have been part of some kind of replay attack (but that's hard to reason about).</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='15a4cbce'/></form></details></div><div class="multiquestion">
<div class='question' id='q4' slug='da676c62'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.54) (see above)
<p>When executing the instruction <code>addq %r8, %r9</code> on a single-cycle processor,
the register file's inputs will include ___. <strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>4%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='6c50b8f2' disabled='disabled'/><div><p>the opcode for <code>addq</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='2571a3de' disabled='disabled'/><div><p>an index that corresponds to <code>%r8</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='4ef99bff' disabled='disabled'/><div><p>an index that corresponds to <code>%r9</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>18%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans4' value='b7eb4a0d' disabled='disabled'/><div><p>the previous value of <code>%r8</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>68%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans4' value='3a8a35c9' disabled='disabled'/><div><p>the result of the addition the instruction performs</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='da676c62'/></form></details></div><div class='question' id='q5' slug='5201696b'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 3.8) (see above)
<p>When executing the instruction <code>addq %r8, %r9</code> on a five-stage pipelined
processor uses the stages we discussed in lecture,
during the <em>decode</em> stage, the register file's inputs will include ___. 
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>14%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='01580819' disabled='disabled'/><div><p>the opcode for <code>addq</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='b3df99a1' disabled='disabled'/><div><p>an index that corresponds to <code>%r8</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>98%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans5' value='22167817' disabled='disabled'/><div><p>an index that corresponds to <code>%r9</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>6%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='1189abf5' disabled='disabled'/><div><p>the previous value of <code>%r8</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans5' value='54824fed' disabled='disabled'/><div><p>the result of the addition the instruction performs</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='5201696b'/></form></details></div></div><div class='question' id='q6' slug='0750ff4a'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.71)
<p>Suppose a pipelined processor has three stages and a cycle time of 200ps.</p>

<p>When this processor executes five instructions, the amount of time from when
the processor starts executing the first stage of the first instruction until when it finishes
executing the last stage of the last instruction is _____ ps.</p>

<p>Assume nothing prevents the processor from starting a new instruction each cycle.</p>

<p>If not enough information is provided, write "unknown" and explain in the comments.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans6' disabled='disabled'/></div>Key: <tt>3 * 200 (first instruction) + 4 * 200 (last stage of next 4 instructions) = 1400</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='0750ff4a'/></form></details></div>
﻿
<h1 style='text-align:center'>quiz for week 13-4</h1><div class='directions'></div><div class='question' id='q1' slug='20b4b514'><div class='description' id='d1'><strong>Question 1</strong> (4 pt; mean 3.56)
<p>Suppose a single-cycle processor takes 1350 ps to execute each instruction. If we can
divide the processor into a pipelined processor with:</p>

<ul>
<li>a fetch stage that takes 300 ps to do its work;</li>
<li>a decode stage that takes 200 ps;</li>
<li>a execute stage that takes 350 ps;</li>
<li>a memory stage that takes 200 ps; and</li>
<li>a writeback stage that takes 300 ps</li>
</ul>

<p>and use pipeline registers (used to transfer values from one stage to the next, and not included in the work
described above) with a 50ps delay. What (as integer number of
ps) is the minimum cycle time the pipelined processor can have?</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans1' disabled='disabled'/></div>Key: <tt>400</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='20b4b514'/></form></details></div><div class="multiquestion"><p>Consider a <em>seven-stage</em> pipelined processor where the stages are:</p>

<ul>
<li>fetch</li>
<li>decode (including reading registers)</li>
<li>execute, part 1</li>
<li>execute, part 2</li>
<li>memory, part 1</li>
<li>memory, part 2</li>
<li>writeback</li>
</ul>

<p>Assume that the results of arithmetic instructions are not available until
near the end of the execute, part 2 stage. The results of instructions that load values
from memory are not available until near the end of the memory, part 2 stage.
Instructions that perform arithmetic need the values for the arithmetic by near the beginning
of the execute, part 1 stage.</p>

<p>The processor uses forwarding (when possible without dramatically increasing cycle time)
in combination with stalling to resolve data hazards.</p>
<div class='question' id='q2' slug='97f3d5cd'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 2.89) (see above)
<p>When executing the following assembly snippet:</p>

<pre><code>movq 0x1234(%r8), %r9     
addq %r9, %r10            
</code></pre>

<p>The processor will complete the writeback stage of the addq instruction ___ cycle(s) after
it completes the writeback stage of the movq instruction.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans2' disabled='disabled'/></div>Key: <tt>4</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='97f3d5cd'/></form></details></div><div class='question' id='q3' slug='320e1483'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.32) (see above)
<p>When executing the following assembly snippet:</p>

<pre><code>addq %r8, %r9
xorq %r9, %r10
subq %r9, %r11
</code></pre>

<p>The processor will complete the xorq instruction ___ cycle(s) after
it completes the addq instruction, and will be complete the subq
instruction ___ cycle(s) after it completes the xorq instruction.</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>11%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans3' value='7174b5a9' disabled='disabled'/><div><p>1 cycle / 1 cycle</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>83%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='radio' name='ans3' value='b5098c51' disabled='disabled'/><div><p>2 cycles / 1 cycle</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans3' value='c5e17d59' disabled='disabled'/><div><p>1 cycle / 2 cycles</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>3%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans3' value='709caf2f' disabled='disabled'/><div><p>2 cycles / 2 cycles</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'></div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'> </div><input type='radio' name='ans3' value='0fc88b72' disabled='disabled'/><div><p>none of the above (explain in comments)</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='320e1483'/></form></details></div></div><div class='question' id='q4' slug='6fcfd2b6'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 3.36)
<p>Consider a pipelined processor design with six pipeline stages
with a cycle time of 500 ps.</p>

<p>When a benchmark program is run on this processor:</p>

<ul>
<li>20% of instructions run have a data hazard that is resolved by forwarding alone;</li>
<li>10% of instructions run have a data hazard that is resolved using a combination of one cycle of
stalling a forwarding</li>
<li>5% of instructions run have a data hazard that is resolved using a combination of two cycles of
stalling a forwarding</li>
<li>2% of instructions are branches that are predicted, for each of which the processor spends 4 cycles
fetching instructions that will need to be squashed</li>
</ul>

<p>Suppose these are the only cause of the processor not running one instruction per cycle.</p>

<p>If the benchmark program has one billion instructions, how long, 
in milliseconds to the nearest millisecond, does it take to run on this processsor?</p>

<p>[1 billion picoseconds is 1 millisecond.]</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans4' disabled='disabled'/></div>Key: <tt>640</tt><div class='explanation'><p>meant to write "of stalling and forwarding" instead of "of stalling a forwarding" (I hope this didn't confuse people???)</p>

<p>(1 + .1 + .05 * 2 + .02 * 4) cycles/instruction * 500 ps/cycle = 640 ps/instruction</p>

<p>1B instructions * 640 ps/instruction = 640 ms</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='6fcfd2b6'/></form></details></div><div class="multiquestion"><p>Suppose a processor runs the following assembly snippet:</p>

<pre><code>    movq $3, %r10
outer: 
    movq $2, %r11
inner:
    call foo
    subq $1, %r11
    cmpq $0, %r11
    jg inner
    subq $1, %r10
    cmpq $0, %r10
    jg outer
</code></pre>

<p>which could have been generated from this C code:</p>

<pre><code>for (int i = 3; i &gt; 0; i--) {
    for (int j = 2; j &gt; 0; j--) {
        foo();
    }
}
</code></pre>
<div class='question' id='q5' slug='6f525f75'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 2.26) (see above)
<p>Suppose this processor uses a branch prediction strategy where it predicts a branch 
(such as a conditional jump) as taken if and only if it ran before and was taken
the last time it ran (and predicts it as not taken otherwise).
(This means that if a conditional jump has never been run before, it is always predicted as not taken.)</p>

<p>Ignoring what happens in the function <code>foo</code>, the first time the above snippet is run, how
many correct branch predictions for the <code>jg</code> instructions will happen?</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans5' disabled='disabled'/></div>Key: <tt>1</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='6f525f75'/></form></details></div></div><div class='question' id='q6' slug='da5fc9b8'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.56)
<p>Consider the following assembly snippet:</p>

<pre><code>addq %r9, %r10
movq 0(%r13), %r9
subq %r9, %r11
</code></pre>

<p>On an out-of-order processor, it's possible for the <code>addq</code>'s result to be computed <em>after</em> the <code>subq</code>'s result is,
depending on the speed of the instructions before the assembly snippet and the <code>movq</code>
in the assembly snippet.
Which of the following make this <em>more</em> likely to happen than otherwise?
(In this question, when an instruction is "unusually slow", it takes longer than normal for an instruction's
result to be available once it is fetched.)
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>81%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='7474e4f4' disabled='disabled'/><div><p>an instruction that sets <code>%r9</code> before the assembly snippet being unusually slow</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>89%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='59fa06e5' disabled='disabled'/><div><p>an instruction that sets <code>%r10</code> before the assembly snippet being unusually slow</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>2%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='893795e5' disabled='disabled'/><div><p>an instruction that sets <code>%r11</code> before the assembly snippet being unusually slow</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>12%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='839e8cc5' disabled='disabled'/><div><p>the <code>movq 0(%r13), %r9</code> being unusually slow</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='da5fc9b8'/></form></details></div>
﻿
<h1 style='text-align:center'>quiz for week 15</h1><div class='directions'></div><div class='question' id='q1' slug='d2e907d6'><div class='description' id='d1'><strong>Question 1</strong> (5 pt; mean 3.95)
<p>Consider the following assembly snippet:</p>

<pre><code>addq %r8, %r9
xorq %r9, %r10
imulq %r10, %r12
addq %r11, %r10
imulq %r10, %r13
subq %r9, %r14
</code></pre>

<p>When executed on an out-of-order processor,
which instructions from the snippet
could have their results computed at the same time as
<code>imulq %r10, %r12</code> on this processor?
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>16%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='4aea9ef1' disabled='disabled'/><div><p><code>addq %r8, %r9</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>1%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans1' value='e19ecc6d' disabled='disabled'/><div><p><code>xorq %r9, %r10</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>86%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='cfd4515c' disabled='disabled'/><div><p><code>addq %r11, %r10</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>32%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='9c4513c9' disabled='disabled'/><div><p><code>imulq %r10, %r13</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>93%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans1' value='8b358b16' disabled='disabled'/><div><p><code>subq %r9, %r14</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='d2e907d6'/></form></details></div><div class='question' id='q2' slug='c5f366b2'><div class='description' id='d2'><strong>Question 2</strong> (4 pt; mean 3.76)
<p>Suppose an out-of-order processor using a design like
we discused in lecture has 3 ALUs that each can perform
an addition in one cycle.</p>

<p>If the processor is running the following assembly snippet:</p>

<pre><code>addq %r8,  %r14
addq %r9,  %r15
addq %r10, %r14
addq %r11, %r15
addq %r12, %r14
addq %r13, %r15
addq %r14, %r15
</code></pre>

<p>To perform the additions for the assembly snippet, the processor
must use a minimum of ___ cycles. (Do not include the time needed
to load the instructions into the instruction queue or needed
to writeback values or commit instructions. Assume once a computation
is performed, its results can be used in a computation during
the next cycle.)</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans2' disabled='disabled'/></div>Key: <tt>4</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='c5f366b2'/></form></details></div><div class="multiquestion"><p>Consider the following C function that adds two arbitrary-precision integers represented
by an array of digit values ranging from 0 to 9, starting with the 1's place.</p>

<pre><code>void AddNumbers(int num_digits, const char *a_digits, const char *b_digits, char *result_digits) {
    char carry = 0;
    for (int i = 0; i &lt; num_digits; ++i) {
        result_digits[i] = a_digits[i] + b_digits[i] + carry;
        carry = 0;
        while (result_digits[i] &gt; 10) {
            result_digits[i] -= 10;
            carry += 1;
        }
    }
}
</code></pre>

<p>Assume this is translated to assembly in a way which does not omit any arithmetic operations
written in the C code above
and that it runs on a processor where each arithmetic and comparison instruction takes a constant
amount of time.</p>
<div class='question' id='q3' slug='61b3455a'><div class='description' id='d3'><strong>Question 3</strong> (4 pt; mean 3.71) (see above)
<p>Suppose we find that running the function with <code>num_digits</code> of 4
and <code>a_digits</code> of <code>{9, 8, 7, 0}</code> and <code>b_digits</code> of <code>{2, 2, 1, 1}</code>
is consistently <em>slower</em> than running with an <code>a_digits</code>
value of <code>{5, 8, 1, 1}</code>  and an unknown value of <code>b_digits</code>.</p>

<p>Which of the following would be plausible values for <code>b_digits</code>?</p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>86%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='69b5d8f3' disabled='disabled'/><div><p><code>{1, 1, 9, 1}</code></p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>34%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤ (accepted any answer)</div><input type='checkbox' name='ans3' value='cc246a0e' disabled='disabled'/><div><p><code>{5, 2, 1, 1}</code></p>
</div></label><div class='explanation'><p>would be false if code corrected to do <code>result_digits[i] &gt;= 10</code></p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>28%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤ (accepted any answer)</div><input type='checkbox' name='ans3' value='dc5799e5' disabled='disabled'/><div><p><code>{5, 6, 7, 8}</code></p>
</div></label><div class='explanation'><p>would be false if code corrected to do <code>result_digits[i] &gt;= 10</code></p>
</div></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>84%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans3' value='12c988f4' disabled='disabled'/><div><p><code>{9, 0, 8, 7}</code></p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='61b3455a'/></form></details></div><div class='question' id='q4' slug='15e53c60'><div class='description' id='d4'><strong>Question 4</strong> (4 pt; mean 2.27) (see above)
<p>Suppose we knew that the <code>AddNumbers()</code> function above was called with
<code>a_digits</code> being the address <code>0x1000000</code>, <code>b_digits</code> the address <code>0x2000000</code>
and <code>result_digits</code> the address <code>0x3000000</code>.</p>

<p>Using a side-chanel we determine that running <code>AddNumbers()</code> accesses
cache set indexes 0 through 2 inclusive of a 64KB direct-mapped cache with 32-byte blocks.
Assuming that only accesses to <code>a_digits</code>, <code>b_digits</code>, and <code>result_digits</code>
used this cache, give a <em>possible</em> value of <code>num_digits</code>.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans4' disabled='disabled'/></div>Key: <tt>between 65 and 96 inclusive</tt><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='15e53c60'/></form></details></div></div><div class="multiquestion"><p>Consider the following C code:</p>

<pre><code>struct message {
    unsigned int message_type;
    unsigned int message_length;
    char *data;
}; 

struct message_type {
     unsigned int seen_messages;
     ...
};

struct message pending_messages[MAX_NUM_MESSAGES];
struct message_type message_types[NUM_MESSAGE_TYPES];

void HandleMessage(int index) {
     if (index &lt; MAX_NUM_MESSAGES) {
         unsigned int type = pending_messages[index].message_type;
         if (type &lt; NUM_MESSAGE_TYPES) {
              message_types[type].seen_messages += 1;
              ... // additional message handling code
         }
     } else {
         abort();
     }
}
</code></pre>

<p>Assume that:</p>

<ul>
<li><code>pending_messages</code> is located at address 0x101000,</li>
<li><code>message_types</code> at address 0x108000,</li>
<li><code>sizeof(struct message)</code> is 16,</li>
<li><code>sizeof(struct message_type)</code> is 128,</li>
<li>the system runs with a single direct-mapped 256KB (2 to the 18 byte) data cache with 64 byte blocks (this cache has 4096 blocks and 4096 sets)</li>
</ul>

<p>If an attacker can cause the above code to execute speculatively with a chosen value of the argument <code>index</code>,
then they can use the above code to execute a Spectre-style attack and read an integer from memory
at an attacker-chosen address that the above code can access but the attacker cannot.</p>

<p>In particular, the
attacker would set <code>index</code> such that <code>pending_messages[index].message_type</code> ends up being located at the address.
The code that increments <code>seen_messages</code> would access a memory location based on this value, which will
cause the cache to be modified (even if this code is only executed speculatively).</p>

<p>The attacker will use a side channel to determine which sets of the data cache were accesssed when the
increment of <code>seen_messages</code> was speculatively executed, and therefore learn about the value of <code>type</code>, which is
the same as the value in the memory location the attacker chose.</p>
<div class='question' id='q5' slug='1bd17250'><div class='description' id='d5'><strong>Question 5</strong> (4 pt; mean 2.51) (see above)
<p>Suppose an attacker selects <code>index</code> such that <code>type</code> ends up being the value of an attacker-chosen address when the above code is run as part of a branch misprediction.
If the attacker discovers that cache set index 44 is modified as a result of <code>message_types[type].seen_messages += 1</code>,
then <em>a</em> possible value of <code>type</code> was ____.
Write your answer as a hexadecimal number.</p>
</div><div class='tinput text'><span>Answer:</span><input type='text' name='ans5' disabled='disabled'/></div>Key: <tt>0x716 or 0xf16 or 0x1716 or 0x1f16 or, etc.</tt><div class='explanation'><p>messge_types[0].seen_messages is in set 512, message_types[1].seen_messages in set 514, message_types[2].seen_messages in set 516, message_types[3].seen_messages in set 519, message_types[4].seen_messages in set 520, etc.</p>

<p>44 - 512 + 4096 = 3628 blocks away, or 3628 + 4096, or 4628 + 4096 * 2, etc.</p>

<p>3628 or 3628 + 4096 or 3628 + 4096*2 blocks ~~ index 3628/2 = 1814 or 1814+2048 = 3862 or ...</p>

<p>or, converted to hex 0x716 or 0xf16 or 0x1716 or 0x1f16, etc.</p>
</div><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='1bd17250'/></form></details></div><div class='question' id='q6' slug='92e67142'><div class='description' id='d6'><strong>Question 6</strong> (4 pt; mean 3.37) (see above)
<p>Which of the following changes to the above code would make the attack infeasible?
<strong>Select all that apply.</strong></p>
</div><ol class="options"><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>37%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='faba1ee0' disabled='disabled'/><div><p>if <code>seen_messages</code> was only read instead of being incremented</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>12%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='1843ab68' disabled='disabled'/><div><p>if the cache was 2-way set-associative instead of direct-mapped</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>5%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'></div><input type='checkbox' name='ans6' value='e7d70558' disabled='disabled'/><div><p>if the branch predictor always predicted <code>(index &lt; MAX_NUM_MESSAGES)</code> as true</p>
</div></label></li><li><label><div style='flex-basis: 2.8em; text-align:right; flex-grow:0; flex-shrink:0;'>91%</div><div style='flex-basis: 1.5em; text-align:right; flex-grow:0; flex-shrink:0; color:green;'>⊤</div><input type='checkbox' name='ans6' value='896aac09' disabled='disabled'/><div><p>if the branch predictor always predicted <code>(type &lt; NUM_MESSAGE_TYPES)</code> as false</p>
</div></label></li></ol><details><summary>Regrade request</summary><form method='POST'><div class='tinput regrade'><textarea name='request'></textarea><input type='submit' value='submit request'/></div><input type='hidden' name='regrade' value='92e67142'/></form></details></div></div>
